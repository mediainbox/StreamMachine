{
  "version": 3,
  "file": "index.js",
  "sourceRoot": "../../../../src/streammachine/master/",
  "sources": [
    "index.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "_       = require \"underscore\"\r\ntemp    = require \"temp\"\r\nnet     = require \"net\"\r\nfs      = require \"fs\"\r\nexpress     = require \"express\"\r\nThrottle    = require \"throttle\"\r\n\r\ndebug = require(\"debug\")(\"sm:master:index\")\r\n\r\nRedis       = require \"../stores/redis_store\"\r\nMasterConfigRedisStore = require \"./config/redis_config\"\r\nMasterAPI         = require \"./admin/api\"\r\nStream      = require \"./stream\"\r\nSourceIn    = require \"./source_in\"\r\nAlerts      = require \"../alerts\"\r\nAnalytics   = require \"../analytics\"\r\nMonitoring  = require \"./monitoring\"\r\nSlaveIO     = require \"./master_io\"\r\nSourceMount = require \"./source_mount\"\r\n\r\nRewindDumpRestore   = require \"../rewind/dump_restore\"\r\n\r\n# A Master handles configuration, slaves, incoming sources, logging and the admin interface\r\n\r\nmodule.exports = class Master extends require(\"events\").EventEmitter\r\n    constructor: (@ctx) ->\r\n        super()\r\n\r\n        @_configured = false\r\n\r\n        @source_mounts  = {}\r\n        @streams        = {}\r\n        @stream_groups  = {}\r\n        @proxies        = {}\r\n\r\n        @config = @ctx.config\r\n        @logger = @ctx.logger\r\n        @log = @ctx.logger # compatibility\r\n        @ctx.master = this\r\n\r\n\r\n        if @config.redis?\r\n            # -- load our streams configuration from redis -- #\r\n\r\n            # we store streams and sources into Redis, but not our full\r\n            # config object. Other stuff still loads from the config file\r\n\r\n            @logger.debug \"Initializing Redis connection\"\r\n            @ctx.providers.redis = new Redis @config.redis\r\n            @configStore = new MasterConfigRedisStore @ctx.providers.redis\r\n            @configStore.on \"config\", (config) =>\r\n                if config\r\n                    # stash the configuration\r\n                    @config = _.defaults config, @config\r\n\r\n                    # (re-)configure our master stream objects\r\n                    @configure @config\r\n\r\n            # Persist changed configuration to Redis\r\n            @logger.debug \"Registering config_update listener\"\r\n            @on \"config_update\", =>\r\n                @configStore._update @getStreamsAndSourceConfig(), (err) =>\r\n                    @logger.info \"Redis config update saved: #{err}\"\r\n\r\n        else\r\n            # -- look for hard-coded configuration -- #\r\n\r\n            process.nextTick =>\r\n                @configure @config\r\n\r\n        @once \"streams\", =>\r\n            @_configured = true\r\n\r\n        # -- create a server to provide the API -- #\r\n\r\n        @api = new MasterAPI @ctx\r\n\r\n        # -- create a backend server for stream requests -- #\r\n\r\n        @transport = new Master.StreamTransport @\r\n\r\n        # -- start the source listener -- #\r\n\r\n        @sourcein = new SourceIn @ctx\r\n\r\n        # -- create an alerts object -- #\r\n        @alerts = new Alerts logger:@logger.child(module:\"alerts\")\r\n\r\n        # -- create a listener for slaves -- #\r\n\r\n        if @config.master\r\n            @slaves = new SlaveIO @, @logger.child(module:\"master_io\"), @config.master\r\n            @on \"streams\", =>\r\n                @slaves.updateConfig @getStreamsAndSourceConfig()\r\n\r\n        # -- Analytics -- #\r\n\r\n        if @config.analytics?.es_uri\r\n            @analytics = new Analytics\r\n                config: @config.analytics\r\n                log:    @logger.child(module:\"analytics\")\r\n                redis:  @redis\r\n\r\n            # add a log transport\r\n            @logger.logger.add new Analytics.LogTransport(@analytics), {}, true\r\n\r\n        # -- Rewind Dump and Restore -- #\r\n\r\n        if @config.rewind_dump\r\n            @rewind_dr = new RewindDumpRestore @, @config.rewind_dump\r\n\r\n        # -- Set up our monitoring module -- #\r\n\r\n        @monitoring = new Monitoring @, @logger.child(module:\"monitoring\")\r\n\r\n    #----------\r\n\r\n    once_configured: (cb) ->\r\n        if @_configured\r\n            cb()\r\n        else\r\n            @once \"streams\", => cb()\r\n\r\n    #----------\r\n\r\n    loadRewinds: (cb) ->\r\n        @once \"streams\", =>\r\n            @rewind_dr?.load cb\r\n\r\n    #----------\r\n\r\n    getStreamsAndSourceConfig: ->\r\n        config = streams:{}, sources:{}\r\n\r\n        config.streams[k] = s.config() for k,s of @streams\r\n        config.sources[k] = s.config() for k,s of @source_mounts\r\n\r\n        return config\r\n\r\n    #----------\r\n\r\n    # configre can be called on a new core, or it can be called to\r\n    # reconfigure an existing core.  we need to support either one.\r\n    configure: (options,cb) ->\r\n        @logger.debug \"configure master\"\r\n\r\n        all_keys = {}\r\n\r\n        # -- Sources -- #\r\n\r\n        new_sources = options?.sources || {}\r\n\r\n        for k,opts of new_sources\r\n            all_keys[ k ] = 1\r\n            @logger.debug \"Configuring Source Mapping #{k}\"\r\n            if @source_mounts[k]\r\n                # existing...\r\n                @source_mounts[k].configure opts\r\n            else\r\n                @_startSourceMount k, opts\r\n\r\n        # -- Streams -- #\r\n\r\n        # are any of our current streams missing from the new options? if so,\r\n        # disconnect them\r\n        new_streams = options?.streams || {}\r\n        for k,obj of @streams\r\n            if !new_streams?[k]\r\n                @logger.debug \"calling destroy on \", k\r\n                obj.destroy()\r\n                delete @streams[ k ]\r\n\r\n        # run through the streams we've been passed, initializing sources and\r\n        # creating rewind buffers\r\n        for key,opts of new_streams\r\n            @logger.debug \"Parsing stream for #{key}\"\r\n\r\n            # does this stream have a mount?\r\n            mount_key = opts.source || key\r\n            all_keys[mount_key] = 1\r\n\r\n            if !@source_mounts[mount_key]\r\n                # create a mount\r\n                @logger.debug \"Creating an unspecified source mount for #{mount_key} (via #{key}).\"\r\n                @_startSourceMount mount_key, _(opts).pick('source_password','format','monitored')\r\n\r\n            mount = @source_mounts[mount_key]\r\n\r\n            # do we need to create the stream?\r\n            if @streams[key]\r\n                # existing stream...  pass it updated configuration\r\n                @logger.debug \"Passing updated config to master stream: #{key}\", opts:opts\r\n                @streams[key].configure opts\r\n            else\r\n                @logger.debug \"Starting up master stream: #{key}\", opts:opts\r\n                @_startStream key, mount, opts\r\n\r\n            # part of a stream group?\r\n            if g = @streams[key].opts.group\r\n                # do we have a matching group?\r\n                sg = ( @stream_groups[ g ] ||= new Stream.StreamGroup g, @logger.child stream_group:g )\r\n                sg.addStream @streams[key]\r\n\r\n        @emit \"streams\", @streams\r\n\r\n        # -- Remove Old Source Mounts -- #\r\n\r\n        for k,obj of @source_mounts\r\n            if !all_keys[k]\r\n                @logger.debug \"Destroying source mount #{k}\"\r\n                # FIXME: Implement?\r\n\r\n        cb? null, streams:@streams, sources:@source_mounts\r\n\r\n    #----------\r\n\r\n    _startSourceMount: (key,opts) ->\r\n        mount = new SourceMount key, @logger.child(source_mount:key), opts\r\n\r\n        if mount\r\n            @source_mounts[ key ] = mount\r\n            @emit \"new_source_mount\", mount\r\n            return mount\r\n        else\r\n            return false\r\n\r\n    #----------\r\n\r\n    _startStream: (key,mount,opts) ->\r\n        stream = new Stream key, @logger.child(stream:key), mount, _.extend opts,\r\n            hls:        @config.hls\r\n            preroll:    if opts.preroll? then opts.preroll else @config.preroll\r\n            transcoder: if opts.transcoder? then opts.transcoder else @config.transcoder\r\n            log_interval: if opts.log_interval? then opts.log_interval else @config.log_interval\r\n\r\n        if stream\r\n            # attach a listener for configs\r\n            stream.on \"config\", => @emit \"config_update\"; @emit \"streams\", @streams\r\n\r\n            @streams[ key ] = stream\r\n            @_attachIOProxy stream\r\n\r\n            @emit \"new_stream\", stream\r\n            return stream\r\n        else\r\n            return false\r\n\r\n    #----------\r\n\r\n    createStream: (opts,cb) ->\r\n        @logger.debug \"createStream called with \", opts\r\n\r\n        # -- make sure the stream key is present and unique -- #\r\n\r\n        if !opts.key\r\n            cb? \"Cannot create stream without key.\"\r\n            return false\r\n\r\n        if @streams[ opts.key ]\r\n            cb? \"Stream key must be unique.\"\r\n            return false\r\n\r\n        # -- Is there a Source Mount? -- #\r\n\r\n        mount_key = opts.source || opts.key\r\n        if !@source_mounts[mount_key]\r\n            # create a mount\r\n            @logger.debug \"Creating an unspecified source mount for #{mount_key} (via #{opts.key}).\"\r\n            @_startSourceMount mount_key, _(opts).pick('source_password','format')\r\n\r\n        # -- create the stream -- #\r\n\r\n        if stream = @_startStream opts.key, @source_mounts[mount_key], opts\r\n            @emit \"config_update\"\r\n            @emit \"streams\", @streams\r\n            cb? null, stream.status()\r\n        else\r\n            cb? \"Stream failed to start.\"\r\n\r\n    #----------\r\n\r\n    updateStream: (stream,opts,cb) ->\r\n        @logger.info \"updateStream called for \", key:stream.key, opts:opts\r\n\r\n        # -- if they want to rename, the key must be unique -- #\r\n\r\n        if opts.key && stream.key != opts.key\r\n            if @streams[ opts.key ]\r\n                cb? \"Stream key must be unique.\"\r\n                return false\r\n\r\n            @streams[ opts.key ] = stream\r\n            delete @streams[ stream.key ]\r\n\r\n        # -- if we're good, ask the stream to configure -- #\r\n\r\n        stream.configure opts, (err,config) =>\r\n            if err\r\n                cb? err\r\n                return false\r\n\r\n\r\n            cb? null, config\r\n\r\n    #----------\r\n\r\n    removeStream: (stream,cb) ->\r\n        @logger.info \"removeStream called for \", key:stream.key\r\n\r\n        delete @streams[ stream.key ]\r\n        stream.destroy()\r\n\r\n        @emit \"config_update\"\r\n        @emit \"streams\", @streams\r\n\r\n        cb? null, \"OK\"\r\n\r\n    #----------\r\n\r\n    createMount: (opts,cb) ->\r\n        @logger.info \"createMount called for #{opts.key}\", opts:opts\r\n\r\n        # -- make sure the mount key is present and unique -- #\r\n\r\n        if !opts.key\r\n            cb? \"Cannot create mount without key.\"\r\n            return false\r\n\r\n        if @source_mounts[ opts.key ]\r\n            cb? \"Mount key must be unique.\"\r\n            return false\r\n\r\n        if mount = @_startSourceMount opts.key, opts\r\n            @emit \"config_update\"\r\n            cb? null, mount.status()\r\n        else\r\n            cb? \"Mount failed to start.\"\r\n\r\n    #----------\r\n\r\n    updateMount: (mount,opts,cb) ->\r\n        @logger.info \"updateMount called for #{mount.key}\", opts:opts\r\n\r\n        # -- if they want to rename, the key must be unique -- #\r\n\r\n        if opts.key && mount.key != opts.key\r\n            if @source_mounts[ opts.key ]\r\n                cb? \"Mount key must be unique.\"\r\n                return false\r\n\r\n            @source_mounts[ opts.key ] = mount\r\n            delete @source_mounts[ mount.key ]\r\n\r\n        # -- if we're good, ask the mount to configure -- #\r\n\r\n        mount.configure opts, (err,config) =>\r\n            return cb? err if err\r\n            cb? null, config\r\n\r\n    #----------\r\n\r\n    removeMount: (mount,cb) ->\r\n        @logger.info \"removeMount called for #{mount.key}\"\r\n\r\n        # it's illegal to remove a mount that still has streams hooked up to it\r\n        if mount.listeners(\"data\").length > 0\r\n            cb new Error(\"Cannot remove source mount until all streams are removed\")\r\n            return false\r\n\r\n        delete @source_mounts[ mount.key ]\r\n        mount.destroy()\r\n\r\n        @emit \"config_update\"\r\n\r\n        cb null, \"OK\"\r\n\r\n    #----------\r\n\r\n    streamsInfo: ->\r\n        obj.status() for k,obj of @streams\r\n\r\n    groupsInfo: ->\r\n        obj.status() for k,obj of @stream_groups\r\n\r\n    sourcesInfo: ->\r\n        obj.status() for k,obj of @source_mounts\r\n\r\n    #----------\r\n\r\n    vitals: (stream,cb) ->\r\n        if s = @streams[ stream ]\r\n            s.vitals cb\r\n        else\r\n            cb \"Invalid Stream\"\r\n\r\n    #----------\r\n\r\n    getHLSSnapshot: (stream,cb) ->\r\n        if s = @streams[ stream ]\r\n            s.getHLSSnapshot cb\r\n        else\r\n            cb \"Invalid Stream\"\r\n\r\n    #----------\r\n\r\n    status: ->\r\n        streams:    @streamsInfo()\r\n        groups:     @groupsInfo()\r\n        sources:    @sourcesInfo()\r\n\r\n    #----------\r\n\r\n    # Get a status snapshot by looping through each stream to get buffer stats\r\n    _rewindStatus: ->\r\n        status = {}\r\n        status[ key ] = s.rewind._rStatus() for key,s of @streams\r\n        status\r\n\r\n    #----------\r\n\r\n    slavesInfo: ->\r\n        if @slaves\r\n            slaveCount: Object.keys(@slaves.slaves).length\r\n            slaves:     ( { id:k, status:s.last_status||\"WARMING UP\" } for k,s of @slaves.slaves )\r\n            master:     @_rewindStatus()\r\n        else\r\n            slaveCount: 0\r\n            slaves:     []\r\n            master:     @_rewindStatus()\r\n\r\n    #----------\r\n\r\n    sendHandoffData: (rpc,cb) ->\r\n        fFunc = _.after 2, =>\r\n            @logger.info \"Rewind buffers and sources sent.\"\r\n            cb null\r\n\r\n        # -- Source Mounts -- #\r\n\r\n        rpc.once \"sources\", (msg,handle,cb) =>\r\n            @logger.info \"Received request for sources.\"\r\n\r\n            # iterate through each source mount, sending each of its sources\r\n\r\n            mounts = _.values @source_mounts\r\n\r\n            _sendMount = =>\r\n                mount = mounts.shift()\r\n\r\n                if !mount\r\n                    cb null\r\n                    return fFunc()\r\n\r\n                sources = mount.sources.slice()\r\n\r\n                _sendSource = =>\r\n                    source = sources.shift()\r\n                    return _sendMount() if !source\r\n\r\n                    @logger.info \"Sending source #{mount.key}/#{source.uuid}\"\r\n                    rpc.request \"source\",\r\n                        mount:      mount.key\r\n                        type:       source.HANDOFF_TYPE\r\n                        opts:       format:source.opts.format, uuid:source.uuid, source_ip:source.opts.source_ip, connectedAt:source.connectedAt\r\n                    , source.opts.sock\r\n                    , (err,reply) =>\r\n                        @logger.error \"Error sending source #{mount.key}/#{source.uuid}: #{err}\" if err\r\n                        _sendSource()\r\n\r\n                _sendSource()\r\n\r\n            _sendMount()\r\n\r\n        # -- Stream Rewind Buffers -- #\r\n\r\n        rpc.once \"stream_rewinds\", (msg,handle,cb) =>\r\n            @logger.info \"Received request for rewind buffers.\"\r\n\r\n            streams = _(@streams).values()\r\n\r\n            _sendStream = =>\r\n                stream = streams.shift()\r\n\r\n                if !stream\r\n                    cb null\r\n                    return fFunc()\r\n\r\n                _next = _.once =>\r\n                    _sendStream()\r\n\r\n                if stream.rewind.bufferedSecs() > 0\r\n                    # set up a socket to accept the buffer on\r\n                    spath = temp.path suffix:\".sock\"\r\n\r\n                    @logger.info \"Asking to send rewind buffer for #{stream.key} over #{spath}.\"\r\n\r\n                    sock = net.createServer()\r\n\r\n                    sock.listen spath, =>\r\n                        sock.once \"connection\", (c) =>\r\n                            stream.getRewind (err,writer) =>\r\n                                if err\r\n                                    @logger.error \"Failed to get rewind buffer for #{stream.key}\"\r\n                                    _next()\r\n\r\n                                writer.pipe(c)\r\n                                writer.once \"end\", =>\r\n                                    @logger.info \"RewindBuffer for #{ stream.key } written to socket.\"\r\n\r\n                        rpc.request \"stream_rewind\", key:stream.key,path:spath, null, timeout:10000, (err) =>\r\n                            if err\r\n                                @logger.error \"Error sending rewind buffer for #{stream.key}: #{err}\"\r\n                            else\r\n                                @logger.info \"Rewind buffer sent and ACKed for #{stream.key}\"\r\n\r\n                            # cleanup...\r\n                            sock.close => fs.unlink spath, (err) =>\r\n                                @logger.info \"RewindBuffer socket unlinked.\", error:err\r\n                                _next()\r\n                else\r\n                    # no need to send a buffer for an empty stream\r\n                    _next()\r\n\r\n            _sendStream()\r\n\r\n    #----------\r\n\r\n    loadHandoffData: (rpc,cb) ->\r\n        # -- set up a listener for stream rewinds and sources -- #\r\n\r\n        rpc.on \"source\", (msg,handle,cb) =>\r\n            mount = @source_mounts[ msg.mount ]\r\n            source = new (require \"../sources/#{msg.type}\") _.extend {}, msg.opts, sock:handle, logger:mount.log\r\n            mount.addSource source\r\n            @logger.info \"Added mount source: #{mount.key}/#{source.uuid}\"\r\n            cb null\r\n\r\n        rpc.on \"stream_rewind\", (msg,handle,cb) =>\r\n            stream = @streams[msg.key]\r\n\r\n            @logger.info \"Stream Rewind will load over #{msg.path}.\"\r\n\r\n            sock = net.connect msg.path, (err) =>\r\n                @logger.info \"Reader socket connected for rewind buffer #{msg.key}\", error:err\r\n                return cb err if err\r\n\r\n                stream.rewind.loadBuffer sock, (err,stats) =>\r\n                    if err\r\n                        @logger.error \"Error loading rewind buffer: #{err}\"\r\n                        cb err\r\n\r\n                    cb null\r\n\r\n        af = _.after 2, =>\r\n            cb null\r\n\r\n\r\n        # -- Request Sources -- #\r\n\r\n        rpc.request \"sources\", {}, null, timeout:10000, (err) =>\r\n            if err\r\n                @logger.error \"Failed to get sources from handoff initiator: #{err}\"\r\n            else\r\n                @logger.info \"Received sources from handoff initiator.\"\r\n\r\n            af()\r\n\r\n        # -- Request Stream Rewind Buffers -- #\r\n\r\n        rpc.request \"stream_rewinds\", {}, null, timeout:10000, (err) =>\r\n            if err\r\n                @logger.error \"Failed to get stream rewinds from handoff initiator: #{err}\"\r\n            else\r\n                @logger.info \"Received stream rewinds from handoff initiator.\"\r\n\r\n            af()\r\n\r\n    #----------\r\n\r\n    _attachIOProxy: (stream) ->\r\n        @logger.debug \"attachIOProxy call for #{stream.key}.\", slaves:@slaves?, proxy:@proxies[stream.key]?\r\n        return false if !@slaves\r\n\r\n        if @proxies[ stream.key ]\r\n            return false\r\n\r\n        # create a new proxy\r\n        @logger.debug \"Creating StreamProxy for #{stream.key}\"\r\n        @proxies[ stream.key ] = new Master.StreamProxy key:stream.key, stream:stream, master:@\r\n\r\n        # and attach a listener to destroy it if the stream is removed\r\n        stream.once \"destroy\", =>\r\n            @proxies[ stream.key ]?.destroy()\r\n            delete @proxies[ stream.key ]\r\n\r\n    #----------\r\n\r\n    class @StreamTransport\r\n        constructor: (@master) ->\r\n            @app = express()\r\n\r\n            # -- Param Handlers -- #\r\n\r\n            @app.param \"stream\", (req,res,next,key) =>\r\n                # make sure it's a valid stream key\r\n                if key? && s = @master.streams[ key ]\r\n                    req.stream = s\r\n                    next()\r\n                else\r\n                    res.status(404).end \"Invalid stream.\\n\"\r\n\r\n            # -- Validate slave id -- #\r\n\r\n            @app.use (req,res,next) =>\r\n                sock_id = req.get 'stream-slave-id'\r\n                if sock_id && @master.slaves.slaves[ sock_id ]\r\n                    #req.slave_socket = @master.slaves[ sock_id ]\r\n                    next()\r\n\r\n                else\r\n                    @master.log.debug \"Rejecting StreamTransport request with missing or invalid socket ID.\", sock_id:sock_id\r\n                    res.status(401).end \"Missing or invalid socket ID.\\n\"\r\n\r\n            # -- Routes -- #\r\n\r\n            @app.get \"/:stream/rewind\", (req,res) =>\r\n                @master.log.debug \"Rewind Buffer request from slave on #{req.stream.key}.\"\r\n                res.status(200).write ''\r\n                req.stream.getRewind (err,writer) =>\r\n                    writer.pipe( new Throttle 100*1024*1024 ).pipe(res)\r\n                    res.on \"end\", =>\r\n                        @master.log.debug \"Rewind dumpBuffer finished.\"\r\n\r\n    #----------\r\n\r\n    class @StreamProxy extends require(\"events\").EventEmitter\r\n        constructor: (opts) ->\r\n            super()\r\n\r\n            @key = opts.key\r\n            @stream = opts.stream\r\n            @master = opts.master\r\n\r\n            @dataFunc = (chunk) =>\r\n                @master.slaves.broadcastAudio @key, chunk\r\n\r\n            @hlsSnapFunc = (snapshot) =>\r\n                @master.slaves.broadcastHLSSnapshot @key, snapshot\r\n\r\n            @stream.on \"data\", @dataFunc\r\n            @stream.on \"hls_snapshot\", @hlsSnapFunc\r\n\r\n        destroy: ->\r\n            @stream.removeListener \"data\", @dataFunc\r\n            @stream.removeListener \"hls_snapshot\", @hlsSnapFunc\r\n            @stream = null\r\n            @emit \"destroy\"\r\n\r\n            @removeAllListeners()\r\n\r\n    #----------\r\n"
  ]
}