{
  "version": 3,
  "file": "api.js",
  "sourceRoot": "../../../../../src/streammachine/master/admin/",
  "sources": [
    "api.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "express         = require \"express\"\r\nbodyParser      = require \"body-parser\"\r\napi             = require \"express-api-helper\"\r\npath            = require \"path\"\r\npassport        = require \"passport\"\r\nBasicStrategy   = (require \"passport-http\").BasicStrategy\r\nThrottle        = require \"throttle\"\r\n\r\nUsers = require \"./users\"\r\n\r\nmodule.exports = class API\r\n    constructor: (@master,require_auth=false) ->\r\n        @log = @master.log.child component:\"admin\"\r\n\r\n        @app = express()\r\n\r\n        # -- set up authentication -- #\r\n\r\n        @users = new Users.Local @\r\n\r\n        if require_auth\r\n            passport.use new BasicStrategy (user,passwd,done) =>\r\n                @users.validate user, passwd, done\r\n\r\n            @app.use passport.initialize()\r\n\r\n            @app.use passport.authenticate('basic', { session: false })\r\n\r\n        # -- Param Handlers -- #\r\n\r\n        @app.param \"stream\", (req,res,next,key) =>\r\n            # make sure it's a valid stream key\r\n            if key? && s = @master.streams[ key ]\r\n                req.stream = s\r\n                next()\r\n            else if key? && sg = @master.stream_groups[ key ]\r\n                req.stream = sg._stream\r\n                next()\r\n            else\r\n                res.status(404).end \"Invalid stream.\\n\"\r\n\r\n        @app.param \"mount\", (req,res,next,key) =>\r\n            # make sure it's a valid source mount key\r\n            if key? && s = @master.source_mounts[ key ]\r\n                req.mount = s\r\n                next()\r\n            else\r\n                res.status(404).end \"Invalid source mount.\\n\"\r\n\r\n        # -- options support for CORS -- #\r\n\r\n        corsFunc = (req,res,next) =>\r\n            res.header('Access-Control-Allow-Origin', '*');\r\n            res.header('Access-Control-Allow-Credentials', true);\r\n            res.header('Access-Control-Allow-Methods', 'POST, GET, PUT, DELETE, OPTIONS');\r\n            res.header('Access-Control-Allow-Headers', 'Content-Type');\r\n            next()\r\n\r\n        @app.use corsFunc\r\n\r\n        @app.options \"*\", (req,res) =>\r\n            res.status(200).end \"\"\r\n\r\n        # -- Routing -- #\r\n\r\n        @app.get \"/listeners\", (req,res) =>\r\n            if @master.analytics\r\n                @master.analytics.countListeners (err,listeners) =>\r\n                    if err\r\n                        api.invalid req, res, err\r\n                    else\r\n                        api.ok req, res, listeners\r\n            else\r\n                api.invalid req, res, \"Analytics function is required by listeners endpoint.\"\r\n\r\n        # list streams\r\n        @app.get \"/streams\", (req,res) =>\r\n            # return JSON version of the status for all streams\r\n            api.ok req, res, @master.streamsInfo()\r\n\r\n        # list stream groups\r\n        @app.get \"/stream_groups\", (req,res) =>\r\n            # return JSON version of the status for all streams\r\n            api.ok req, res, @master.groupsInfo()\r\n\r\n        # list source mounts\r\n        @app.get \"/sources\", (req,res) =>\r\n            api.ok req, res, @master.sourcesInfo()\r\n\r\n        # list streams\r\n        @app.get \"/config\", (req,res) =>\r\n            # return JSON version of the status for all streams\r\n            api.ok req, res, @master.config()\r\n\r\n        # list slaves\r\n        @app.get \"/slaves\", (req,res) =>\r\n            api.ok req, res, @master.slavesInfo()\r\n\r\n        # create a stream\r\n        @app.post \"/streams\", bodyParser.json(), (req,res) =>\r\n            # add a new stream\r\n            @master.createStream req.body, (err,stream) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, stream\r\n\r\n        # get stream details\r\n        @app.get \"/streams/:stream\", (req,res) =>\r\n            # get detailed stream information\r\n            api.ok req, res, req.stream.status()\r\n\r\n        # get stream configuration\r\n        @app.get \"/streams/:stream/config\", (req,res) =>\r\n            api.ok req, res, req.stream.config()\r\n\r\n        # update stream metadata\r\n        @app.post \"/streams/:stream/metadata\", bodyParser.json(), (req,res) =>\r\n            req.stream.setMetadata req.body||req.query, (err,meta) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, meta\r\n\r\n        # Update a stream's configuration\r\n        @app.put \"/streams/:stream/config\", bodyParser.json(), (req,res) =>\r\n            @master.updateStream req.stream, req.body, (err,obj) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, obj\r\n\r\n        # Delete a stream\r\n        @app.delete \"/streams/:stream\", (req,res) =>\r\n            @master.removeStream req.stream, (err,obj) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, obj\r\n\r\n        # Dump a RewindBuffer\r\n        @app.get \"/streams/:stream/rewind\", (req,res) =>\r\n            res.status(200).write ''\r\n            req.stream.getRewind (err,io) =>\r\n                # long story... may be related to https://github.com/joyent/node/issues/6065\r\n                # in any case, piping to /dev/null went too fast and crashed the server.\r\n                # Throttling fixes it\r\n                io.pipe( new Throttle 100*1024*1024 ).pipe(res)\r\n\r\n        # Clear a Rewind Buffer\r\n        @app.delete \"/streams/:stream/rewind\", (req,res) =>\r\n            req.stream.rewind.resetRewind (err) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, req.stream.status()\r\n\r\n        # Inject a Rewind Buffer\r\n        @app.put \"/streams/:stream/rewind\", (req,res) =>\r\n            req.stream.rewind.loadBuffer req, (err,info) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, info\r\n\r\n        # -- Source Mount API -- #\r\n\r\n        @app.post \"/sources\", bodyParser.json(), (req,res) =>\r\n            # add a new source mount\r\n            @master.createMount req.body, (err,mount) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, mount\r\n\r\n        @app.get \"/sources/:mount\", (req,res) =>\r\n            api.ok req, res, req.mount.status()\r\n\r\n        @app.get \"/sources/:mount/config\", (req,res) =>\r\n            api.ok req, res, req.mount.config()\r\n\r\n        # Promote a source to live\r\n        @app.post \"/sources/:mount/promote\", (req,res) =>\r\n            # promote a stream source to active\r\n            # We'll just pass on the UUID and leave any logic to the stream\r\n            req.mount.promoteSource req.query.uuid, (err,msg) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, msg\r\n\r\n        # Drop a source\r\n        @app.post \"/sources/:mount/drop\", (req,res) =>\r\n            req.mount.dropSource req.query.uuid, (err,msg) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, msg\r\n\r\n        # Update a source's configuration\r\n        @app.put \"/sources/:mount/config\", bodyParser.json(), (req,res) =>\r\n            @master.updateMount req.mount, req.body, (err,obj) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, obj\r\n\r\n        # Delete a stream\r\n        @app.delete \"/sources/:mount\", (req,res) =>\r\n            @master.removeMount req.mount, (err,obj) =>\r\n                if err\r\n                    api.invalid req, res, err.message\r\n                else\r\n                    api.ok req, res, obj\r\n\r\n        # -- User Management -- #\r\n\r\n        # get a list of users\r\n        @app.get \"/users\", (req,res) =>\r\n            @users.list (err,users) =>\r\n                if err\r\n                    api.serverError req, res, err\r\n                else\r\n                    obj = []\r\n\r\n                    obj.push { user:u, id:u } for u in users\r\n\r\n                    api.ok req, res, obj\r\n\r\n        # create / update a user\r\n        @app.post \"/users\", bodyParser.json(), (req,res) =>\r\n            @users.store req.body.user, req.body.password, (err,status) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, ok:true\r\n\r\n        # delete a user\r\n        @app.delete \"/users/:user\", (req,res) =>\r\n            @users.store req.params.user, null, (err,status) =>\r\n                if err\r\n                    api.invalid req, res, err\r\n                else\r\n                    api.ok req, res, ok:true\r\n"
  ]
}