{
  "version": 3,
  "file": "users.js",
  "sourceRoot": "../../../../../src/streammachine/master/admin/",
  "sources": [
    "users.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "PasswordHash = require \"password-hash\"\r\n\r\nmodule.exports = class Users\r\n    constructor: ->\r\n        @_user_lookup = (user,password,cb) =>\r\n            cb? \"Cannot look up users without a valid store loaded.\"\r\n\r\n        @_user_store = (user,password,cb) =>\r\n            cb? \"Cannot store users without a valid store loaded.\"\r\n\r\n        @_user_list = (cb) =>\r\n            cb? \"Cannot list users without a valid store loaded.\"\r\n\r\n    list: (cb) ->\r\n        @_user_list cb\r\n\r\n    validate: (user,password,cb) ->\r\n        @_user_lookup user, password, cb\r\n\r\n    store: (user,password,cb) ->\r\n        @_user_store user, password, cb\r\n\r\n    #-----------\r\n\r\n    class @Local extends Users\r\n        constructor: (@admin) ->\r\n            super()\r\n\r\n            if @admin.master.redis?\r\n                # we're using redis for users\r\n\r\n                @_user_list = (cb) =>\r\n                    @admin.master.redis.once_connected (redis) =>\r\n                        redis.hkeys \"users\", cb\r\n\r\n                @_user_lookup = (user,password,cb) =>\r\n                    @admin.master.redis.once_connected (redis) =>\r\n                        redis.hget \"users\", user, (err,val) =>\r\n                            if err\r\n                                cb? err\r\n                                return false\r\n\r\n                            # see if the hashed passwords match\r\n                            if PasswordHash.verify(password,val)\r\n                                # good to go\r\n                                cb? null, true\r\n\r\n                            else\r\n                                cb? null, false\r\n\r\n                @_user_store = (user,password,cb) =>\r\n                    @admin.master.redis.once_connected (redis) =>\r\n                        console.log \"in user_store for \", user, password\r\n                        if password\r\n                            # store the user\r\n                            hashed = PasswordHash.generate password\r\n\r\n                            console.log \"hashed pass is \", hashed\r\n\r\n                            redis.hset \"users\", user, hashed, (err,result) =>\r\n                                if err\r\n                                    cb? err\r\n                                    return false\r\n\r\n                                cb? null, true\r\n\r\n                        else\r\n                            # delete the user\r\n                            redis.hdel \"users\", user, (err) =>\r\n                                if err\r\n                                    cb? err\r\n                                    return false\r\n\r\n                                cb? null, true\r\n\r\n            else\r\n                # we need to pull users out of the config file\r\n                nconf = require \"nconf\"\r\n\r\n                @_user_list = (cb) =>\r\n                    users = nconf.get(\"users\")\r\n\r\n                    if users\r\n                        cb? null, Object.keys(users)\r\n                    else\r\n                        cb? null, []\r\n\r\n                @_user_lookup = (user,password,cb) =>\r\n                    if hash = nconf.get(\"users:#{user}\")\r\n                        cb? null, PasswordHash.verify(password,hash)\r\n                    else\r\n                        cb? null, false\r\n\r\n                @_user_store = (user,password,cb) =>\r\n                    cb? \"Cannot store passwords when not using Redis.\"\r\n"
  ]
}