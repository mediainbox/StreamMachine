{
  "version": 3,
  "file": "stream.js",
  "sourceRoot": "../../../../../src/streammachine/master/streams/",
  "sources": [
    "stream.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "_       = require \"underscore\"\r\nuuid    = require \"node-uuid\"\r\nURL     = require \"url\"\r\n\r\nRewindBuffer              = require '../../rewind_buffer'\r\nProxySource         = require '../../sources/url_source'\r\n\r\nmodule.exports = class Stream extends require('events').EventEmitter\r\n    DefaultOptions:\r\n        meta_interval:      32768\r\n        max_buffer:         4194304 # 4 megabits (64 seconds of 64k audio)\r\n        key:                null\r\n        seconds:            (60*60*4) # 4 hours\r\n        burst:              30\r\n        source_password:    null\r\n        host:               null\r\n        fallback:           null\r\n        acceptSourceMeta:   false\r\n        log_minutes:        true\r\n        monitored:          false\r\n        metaTitle:          \"\"\r\n        metaUrl:            \"\"\r\n        format:             \"mp3\"\r\n        preroll:            \"\"\r\n        preroll_key:        \"\"\r\n        transcoder:         \"\"\r\n        root_route:         false\r\n        group:              null\r\n        bandwidth:          0\r\n        codec:              null\r\n        ffmpeg_args:        null\r\n        stream_key:         null\r\n        impression_delay:   5000\r\n        log_interval:       30000\r\n        geolock:            null\r\n\r\n    constructor: (@ctx, args)->\r\n        super()\r\n\r\n        { @key, @mount, config } = args\r\n\r\n        @logger = @ctx.logger.child({\r\n            component: \"stream:#{@key}\"\r\n        })\r\n        @config = _.defaults config || {}, @DefaultOptions\r\n\r\n        # We have three options for what source we're going to use:\r\n        # a) Internal: Create our own source mount and manage our own sources.\r\n        #    Basically the original stream behavior.\r\n        # b) Source Mount: Connect to a source mount and use its source\r\n        #    directly. You'll get whatever incoming format the source gets.\r\n        # c) Source Mount w/ Transcoding: Connect to a source mount, but run a\r\n        #    transcoding source between it and us, so that we always get a\r\n        #    certain format as our input.\r\n\r\n        @destroying = false\r\n        @source = null\r\n\r\n        if @config.ffmpeg_args\r\n            # Source Mount w/ transcoding\r\n            @_initTranscodingSource()\r\n\r\n        else\r\n            # Source Mount directly\r\n            @source = @mount\r\n\r\n        # Cache the last stream vitals we've seen\r\n        @_vitals = null\r\n\r\n        @emitDuration = 0\r\n\r\n        @STATUS = \"Initializing\"\r\n\r\n        @logger.info\r\n            key: @key\r\n            config: @config\r\n            message: \"initialize stream handler for #{@key}\"\r\n\r\n        # -- Initialize Master Rewinder -- #\r\n\r\n        # set up a rewind buffer, for use in bringing new slaves up to speed\r\n        # or to transfer to a new master when restarting\r\n        @rewind = new RewindBuffer\r\n            seconds:    @config.seconds\r\n            burst:      @config.burst\r\n            station:    @key\r\n            key:        \"master__#{@key}\"\r\n            logger:        @logger.child(module:\"rewind\")\r\n\r\n        # Rewind listens to us, not to our source\r\n        @rewind.emit \"source\", @\r\n\r\n        # Pass along buffer loads\r\n        @rewind.on \"buffer\", (c) => @emit \"buffer\", c\r\n\r\n        # -- Set up data functions -- #\r\n\r\n        @_meta =\r\n            StreamTitle:    @config.metaTitle\r\n            StreamUrl:      \"\"\r\n\r\n        @sourceMetaFunc = (meta) =>\r\n            if @config.acceptSourceMeta\r\n                @setMetadata meta\r\n\r\n        @dataFunc = (data) =>\r\n            # inject our metadata into the data object\r\n            @emit \"data\", _.extend {}, data, meta:@_meta\r\n\r\n        @vitalsFunc = (vitals) =>\r\n            @_vitals = vitals\r\n            @emit \"vitals\", vitals\r\n\r\n        @source.on \"data\", @dataFunc\r\n        @source.on \"vitals\", @vitalsFunc\r\n\r\n        # -- Hardcoded Source -- #\r\n\r\n        # This is an initial source like a proxy that should be connected from\r\n        # our end, rather than waiting for an incoming connection\r\n\r\n        if @config.fallback?\r\n            # what type of a fallback is this?\r\n            uri = URL.parse @config.fallback\r\n\r\n            newsource = switch uri.protocol\r\n                when \"file:\"\r\n                    new FileSource\r\n                        key:        @key\r\n                        format:     @config.format\r\n                        filePath:   uri.path\r\n                        logger:     @logger\r\n\r\n                when \"http:\", \"https:\"\r\n                    new ProxySource\r\n                        key:        @key\r\n                        format:     @config.format\r\n                        url:        @config.fallback\r\n                        headers:    @config.headers\r\n                        fallback:   true\r\n                        logger:     @logger\r\n\r\n                else\r\n                    null\r\n\r\n            if newsource\r\n                newsource.once \"connect\", =>\r\n                    @addSource newsource, (err) =>\r\n                        if err\r\n                            @logger.error \"Connection to fallback source failed.\"\r\n                        else\r\n                            @logger.debug \"Fallback source connected.\"\r\n\r\n                newsource.on \"error\", (err) =>\r\n                    @logger.error \"Fallback source error: #{err}\", error:err\r\n\r\n            else\r\n                @logger.error \"Unable to determine fallback source type for #{@config.fallback}\"\r\n\r\n    #----------\r\n\r\n    _initTranscodingSource: ->\r\n        @logger.debug \"Setting up transcoding source for #{ @key }\"\r\n\r\n        # -- create a transcoding source -- #\r\n\r\n        tsource = new TranscodingSource\r\n            stream:         @mount\r\n            ffmpeg_args:    @config.ffmpeg_args\r\n            format:         @config.format\r\n            logger:         @logger\r\n\r\n        @source = tsource\r\n\r\n        # if our transcoder goes down, restart it\r\n        tsource.once \"disconnect\", =>\r\n            @logger.error \"Transcoder disconnected for #{ @key }.\"\r\n            process.nextTick (=> @_initTranscodingSource()) if !@destroying\r\n\r\n    #----------\r\n\r\n    addSource: (source,cb) ->\r\n        @source.addSource source, cb\r\n\r\n    #----------\r\n\r\n    # Return our configuration\r\n\r\n    getConfig: ->\r\n        @config\r\n\r\n    #----------\r\n\r\n    vitals: (cb) ->\r\n        _vFunc = (v) =>\r\n            cb? null, v\r\n\r\n        if @_vitals\r\n            _vFunc @_vitals\r\n        else\r\n            @once \"vitals\", _vFunc\r\n\r\n    #----------\r\n\r\n    getStreamKey: (cb) ->\r\n        if @_vitals\r\n            cb? @_vitals.streamKey\r\n        else\r\n            @once \"vitals\", => cb? @_vitals.streamKey\r\n\r\n    #----------\r\n\r\n    status: ->\r\n        # id is DEPRECATED in favor of key\r\n        key:        @key\r\n        id:         @key\r\n        vitals:     @_vitals\r\n        source:     @source.status()\r\n        rewind:     @rewind._rStatus()\r\n\r\n    #----------\r\n\r\n    setMetadata: (opts,cb) ->\r\n        if opts.StreamTitle? || opts.title?\r\n            @_meta.StreamTitle = opts.StreamTitle||opts.title\r\n\r\n        if opts.StreamUrl? || opts.url?\r\n            @_meta.StreamUrl = opts.StreamUrl||opts.url\r\n\r\n        @emit \"meta\", @_meta\r\n\r\n        cb? null, @_meta\r\n\r\n    #----------\r\n\r\n    configure: (new_opts,cb) ->\r\n        # allow updates, but only to keys that are present in @DefaultOptions.\r\n        for k,v of @DefaultOptions\r\n            @config[k] = new_opts[k] if new_opts[k]?\r\n\r\n            # convert to a number if necessary\r\n            @config[k] = Number(@config[k]) if _.isNumber(@DefaultOptions[k])\r\n\r\n        if @key != @config.key\r\n            @key = @config.key\r\n\r\n        # did they update the metaTitle?\r\n        if new_opts.metaTitle\r\n            @setMetadata title:new_opts.metaTitle\r\n\r\n        # Update our rewind settings\r\n        @rewind.setRewind @config.seconds, @config.burst\r\n\r\n        @emit \"config\"\r\n\r\n        cb? null, @config()\r\n\r\n    #----------\r\n\r\n    getRewind: (cb) ->\r\n        @rewind.dumpBuffer (err,writer) =>\r\n            cb? null, writer\r\n\r\n    #----------\r\n\r\n    destroy: ->\r\n        # shut down our sources and go away\r\n        @destroying = true\r\n\r\n        @source.disconnect() if @source instanceof TranscodingSource\r\n        @rewind.disconnect()\r\n\r\n        @source.removeListener \"data\", @dataFunc\r\n        @source.removeListener \"vitals\", @vitalsFunc\r\n\r\n        @dataFunc = @vitalsFunc = @sourceMetaFunc = ->\r\n\r\n        @emit \"destroy\"\r\n        true\r\n\r\n    #----------\r\n"
  ]
}