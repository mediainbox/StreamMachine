{
  "version": 3,
  "file": "redis_config.js",
  "sourceRoot": "../../../../../src/streammachine/master/config/",
  "sources": [
    "redis_config.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,YAAA,EAAA,sBAAA,EAAA;;AAAA,YAAA,GAAe,OAAA,CAAQ,QAAR,CAAiB,CAAC;;AAEjC,KAAA,GAAQ,OAAA,CAAQ,OAAR,CAAA,CAAiB,iBAAjB;;AAER,MAAM,CAAC,OAAP,GAAuB,yBAAN,MAAA,uBAAA,QAAqC,aAArC;EACb,WAAa,MAAA,CAAA;;IAAC,IAAC,CAAA;IAGX,OAAO,CAAC,QAAR,CAAiB,CAAA,CAAA,GAAA;aACb,IAAC,CAAA,OAAD,CAAA;IADa,CAAjB;EAHS,CAAjB;;;EAQI,OAAS,CAAA,CAAA;WACL,IAAC,CAAA,KAAK,CAAC,cAAP,CAAsB,CAAC,MAAD,CAAA,GAAA;MAClB,KAAA,CAAM,4BAAN;aACA,MAAM,CAAC,GAAP,CAAW,IAAC,CAAA,KAAK,CAAC,WAAP,CAAmB,QAAnB,CAAX,EAAyC,CAAC,GAAD,EAAM,KAAN,CAAA,GAAA;AACrD,YAAA;QAAgB,IAAG,KAAH;UACI,MAAA,GAAS,IAAI,CAAC,KAAL,CAAW,KAAK,CAAC,QAAN,CAAA,CAAX;UACT,KAAA,CAAM,sBAAN,EAA8B,MAA9B;iBACA,IAAC,CAAA,IAAD,CAAM,QAAN,EAAgB,MAAhB,EAHJ;SAAA,MAAA;iBAKI,IAAC,CAAA,IAAD,CAAM,QAAN,EAAgB,IAAhB,EALJ;;MADqC,CAAzC;IAFkB,CAAtB;EADK,CARb;;;EAqBK,OAAS,CAAC,MAAD,EAAQ,EAAR,CAAA;WACL,IAAC,CAAA,KAAK,CAAC,cAAP,CAAsB,CAAC,MAAD,CAAA,GAAA;MAClB,KAAA,CAAM,+BAAN;aAEA,MAAM,CAAC,GAAP,CAAW,IAAC,CAAA,KAAK,CAAC,WAAP,CAAmB,QAAnB,CAAX,EAAyC,IAAI,CAAC,SAAL,CAAe,MAAf,CAAzC,EAAiE,CAAC,GAAD,EAAK,KAAL,CAAA,GAAA;QAC9D,IAAG,GAAH;UACI,KAAA,CAAM,CAAA,sCAAA,CAAA,CAAyC,GAAzC,CAAA,CAAN;iBACA,EAAA,CAAG,GAAH,EAFJ;SAAA,MAAA;UAII,KAAA,CAAM,gBAAN,EAAwB,MAAxB,EAAgC,KAAhC;iBACA,EAAA,CAAG,IAAH,EALJ;;MAD8D,CAAjE;IAHkB,CAAtB;EADK;;AAtBG",
  "sourcesContent": [
    "EventEmitter = require('events').EventEmitter\r\n\r\ndebug = require(\"debug\")(\"sm:redis_config\")\r\n\r\nmodule.exports = class MasterConfigRedisStore extends EventEmitter\r\n    constructor: (@redis) ->\r\n        super()\r\n\r\n        process.nextTick =>\r\n            @_config()\r\n\r\n    #----------\r\n\r\n    _config: ->\r\n        @redis.once_connected (client) =>\r\n            debug \"Querying config from Redis\"\r\n            client.get @redis.prefixedKey(\"config\"), (err, reply) =>\r\n                if reply\r\n                    config = JSON.parse(reply.toString())\r\n                    debug \"Got redis config of \", config\r\n                    @emit \"config\", config\r\n                else\r\n                    @emit \"config\", null\r\n\r\n     #----------\r\n\r\n     _update: (config,cb) ->\r\n         @redis.once_connected (client) =>\r\n             debug \"Saving configuration to Redis\"\r\n\r\n             client.set @redis.prefixedKey(\"config\"), JSON.stringify(config), (err,reply) =>\r\n                if err\r\n                    debug \"Redis: Failed to save updated config: #{err}\"\r\n                    cb err\r\n                else\r\n                    debug \"Set config to \", config, reply\r\n                    cb null\r\n"
  ]
}