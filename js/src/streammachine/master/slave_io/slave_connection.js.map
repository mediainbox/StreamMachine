{
  "version": 3,
  "file": "slave_connection.js",
  "sourceRoot": "../../../../../src/streammachine/master/slave_io/",
  "sources": [
    "slave_connection.coffee"
  ],
  "names": [],
  "mappings": "AAEE,IAAA;;AAAA,MAAM,CAAC,OAAP,GAAuB,kBAAN,MAAA,gBAAA,QAA8B,OAAA,CAAQ,QAAR,CAAiB,CAAC,aAAhD;EACd,WAAa,IAAA,QAAA,CAAA;;IAAC,IAAC,CAAA;IAAK,IAAC,CAAA;IAGjB,IAAC,CAAA,EAAD,GAAkB,IAAC,CAAA,MAAM,CAAC;IAC1B,IAAC,CAAA,WAAD,GAAkB;IAClB,IAAC,CAAA,QAAD,GAAkB;IAClB,IAAC,CAAA,YAAD,GAAkB,IAAI,IAAJ,CAAA;IAGlB,IAAC,CAAA,MAAD,GAAU,IAAC,CAAA,GAAG,CAAC,MAAM,CAAC,KAAZ,CAAkB;MACxB,KAAA,EAAO,IAAC,CAAA,MAAM,CAAC;IADS,CAAlB,EARlB;;IAcQ,IAAC,CAAA,MAAD,GAAU,IAAC,CAAA,MAAM,CAAC,KAAR,CAAc;MAAA,KAAA,EAAM,IAAC,CAAA,MAAM,CAAC;IAAd,CAAd;IACV,IAAC,CAAA,MAAM,CAAC,EAAR,CAAW,KAAX,EAAkB,CAAC,MAAM,CAAA,CAAP,CAAA,GAAA;aACd,IAAC,CAAA,MAAM,CAAC,GAAG,CAAC,KAAJ,IAAW,OAAZ,CAAoB,CAAC,KAA5B,CAAkC,IAAC,CAAA,MAAnC,EAA2C,CAAC,GAAG,CAAC,GAAJ,IAAS,EAAV,EAAa,GAAG,CAAC,IAAJ,IAAU,CAAA,CAAvB,CAA3C;IADc,CAAlB,EAfR;;IAoBQ,IAAC,CAAA,MAAM,CAAC,EAAR,CAAW,QAAX,EAAqB,CAAC,GAAD,EAAM,EAAN,CAAA,GAAA,EAAA;;aAEjB,IAAC,CAAA,GAAG,CAAC,MAAM,CAAC,MAAZ,CAAmB,GAAnB,EAAwB,EAAxB;IAFiB,CAArB,EApBR;;IAyBQ,IAAC,CAAA,MAAM,CAAC,EAAR,CAAW,YAAX,EAAyB,CAAA,CAAA,GAAA;aACrB,IAAC,CAAA,iBAAD,CAAA;IADqB,CAAzB;EA1BS,CAAjB;;;EA+BI,MAAQ,CAAC,EAAD,CAAA;WACJ,IAAC,CAAA,MAAM,CAAC,IAAR,CAAa,QAAb,EAAuB,CAAC,GAAD,EAAK,MAAL,CAAA,GAAA;MACnB,IAAC,CAAA,WAAD,GAAkB;MAClB,IAAC,CAAA,QAAD,GAAkB;aAElB,EAAA,CAAG,GAAH,EAAQ,MAAR;IAJmB,CAAvB;EADI,CA/BZ;;;EAwCI,iBAAmB,CAAA,CAAA;AACvB,QAAA;IAAQ,SAAA,GAAY,IAAI,CAAC,KAAL,CAAY,CAAC,MAAA,CAAO,IAAI,IAAJ,CAAA,CAAP,CAAA,GAAqB,MAAA,CAAO,IAAC,CAAA,YAAR,CAAtB,CAAA,GAA+C,IAA3D;IACZ,IAAC,CAAA,MAAM,CAAC,KAAR,CAAc,CAAA,sBAAA,CAAA,CAAyB,IAAC,CAAA,MAAM,CAAC,EAAjC,CAAA,gBAAA,CAAA,CAAuD,SAAvD,CAAA,SAAA,CAAd;WAEA,IAAC,CAAA,IAAD,CAAM,YAAN;EAJe;;AAzCL",
  "sourcesContent": [
    "\r\n\r\nmodule.exports = class SlaveConnection extends require(\"events\").EventEmitter\r\n    constructor: (@ctx, @socket) ->\r\n        super()\r\n\r\n        @id             = @socket.id\r\n        @last_status    = null\r\n        @last_err       = null\r\n        @connected_at   = new Date()\r\n\r\n\r\n        @logger = @ctx.logger.child({\r\n            slave: @socket.id\r\n        })\r\n\r\n        # -- wire up logging -- #\r\n\r\n        @logger = @logger.child slave:@socket.id\r\n        @socket.on \"log\", (obj = {}) =>\r\n            @logger[obj.level||'debug'].apply @logger, [obj.msg||\"\",obj.meta||{}]\r\n\r\n        # -- RPC Handlers -- #\r\n\r\n        @socket.on \"vitals\", (key, cb) =>\r\n# respond with the stream's vitals\r\n            @ctx.master.vitals key, cb\r\n\r\n        # attach disconnect handler\r\n        @socket.on \"disconnect\", =>\r\n            @_handleDisconnect()\r\n\r\n#----------\r\n\r\n    status: (cb) ->\r\n        @socket.emit \"status\", (err,status) =>\r\n            @last_status    = status\r\n            @last_err       = err\r\n\r\n            cb err, status\r\n\r\n#----------\r\n\r\n    _handleDisconnect: ->\r\n        connected = Math.round( (Number(new Date()) - Number(@connected_at)) / 1000 )\r\n        @logger.debug \"Slave disconnect from #{@socket.id}. Connected for #{ connected } seconds.\"\r\n\r\n        @emit \"disconnect\"\r\n"
  ]
}