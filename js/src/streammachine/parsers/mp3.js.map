{
  "version": 3,
  "file": "mp3.js",
  "sourceRoot": "../../../../src/streammachine/parsers/",
  "sources": [
    "mp3.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "strtok = require('strtok2')\r\nassert = require(\"assert\")\r\n\r\nmodule.exports = class MP3 extends require(\"stream\").Writable\r\n    ID3V1_LENGTH = 128\r\n    ID3V2_HEADER_LENGTH = 10\r\n    MPEG_HEADER_LENGTH = 4\r\n\r\n    FIRST_BYTE = new strtok.BufferType(1)\r\n\r\n    # Mp3 parsing logic borrowed from node-lame: https://github.com/TooTallNate/node-lame\r\n\r\n    MPEG_HEADER             = new strtok.BufferType(MPEG_HEADER_LENGTH)\r\n    REST_OF_ID3V2_HEADER    = new strtok.BufferType(ID3V2_HEADER_LENGTH - MPEG_HEADER_LENGTH)\r\n    REST_OF_ID3V1           = new strtok.BufferType(ID3V1_LENGTH - MPEG_HEADER_LENGTH)\r\n\r\n    LAYER1_ID              = 3\r\n    LAYER2_ID              = 2\r\n    LAYER3_ID              = 1\r\n    MPEG1_ID               = 3\r\n    MPEG2_ID               = 2\r\n    MPEG25_ID              = 0\r\n    MODE_MONO              = 3\r\n    MODE_DUAL              = 2\r\n    MODE_JOINT             = 1\r\n    MODE_STEREO            = 0\r\n\r\n    MPEG_NAME              = [ \"MPEG2.5\", null, \"MPEG2\", \"MPEG1\" ]\r\n    LAYER_NAME             = [ null, \"Layer3\", \"Layer2\", \"Layer1\" ]\r\n    MODE_NAME              = [ \"Stereo\", \"J-Stereo\", \"Dual\", \"Mono\" ]\r\n\r\n    SAMPLING_RATES         = [ 44100, 48000, 32000, 0 ]\r\n\r\n    BITRATE_MPEG1_LAYER1   = [ 0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448 ]\r\n    BITRATE_MPEG1_LAYER2   = [ 0, 32, 48, 56, 64,  80, 96,   112, 128, 160, 192, 224, 256, 320, 384 ]\r\n    BITRATE_MPEG1_LAYER3   = [ 0, 32, 40, 48, 56,  64, 80,   96, 112, 128, 160, 192, 224, 256, 320 ]\r\n    BITRATE_MPEG2_LAYER1   = [ 0, 32, 48, 56, 64,  80, 96,   112, 128, 144, 160, 176, 192, 224, 256 ]\r\n    BITRATE_MPEG2_LAYER2A3 = [ 0, 8,  16, 24, 32,  40, 48,   56, 64, 80, 96, 112, 128, 144, 160 ]\r\n\r\n    BITRATE_MAP = [\r\n        [ null, BITRATE_MPEG2_LAYER2A3, BITRATE_MPEG2_LAYER2A3, BITRATE_MPEG2_LAYER1 ], # MPEG2.5\r\n        null,\r\n        [ null, BITRATE_MPEG2_LAYER2A3, BITRATE_MPEG2_LAYER2A3, BITRATE_MPEG2_LAYER1 ], # MPEG2\r\n        [ null, BITRATE_MPEG1_LAYER3, BITRATE_MPEG1_LAYER2, BITRATE_MPEG1_LAYER1 ]\r\n    ]\r\n\r\n    constructor: ->\r\n        super()\r\n\r\n        # create an internal stream to pass to strtok\r\n        @istream = new (require(\"events\").EventEmitter)\r\n\r\n        @outbuf = []\r\n\r\n        @_flushing = false\r\n\r\n        # set up status\r\n        @frameSize = -1\r\n        @beginning = true\r\n        @gotFF = false\r\n        @gotID3 = 0\r\n        @byteTwo = null\r\n\r\n        @frameHeader    = null\r\n        @frameHeaderBuf = null\r\n\r\n        @id3v2 = null\r\n        @_parsingId3v1 = false\r\n        @_parsingId3v2 = false\r\n        @_finishingId3v2 = false\r\n        @_id3v2_1 = null\r\n        @_id3v2_2 = null\r\n\r\n        @_id3v1_1 = null\r\n\r\n        @once \"finish\", =>\r\n            @_flushing = setTimeout =>\r\n                @emit \"end\"\r\n            , 500\r\n\r\n        _emitAndMaybeEnd = (args...) =>\r\n            @emit args...\r\n\r\n            if @_flushing\r\n                clearTimeout @_flushing\r\n                @_flushing = setTimeout =>\r\n                    @emit \"end\"\r\n                , 500\r\n\r\n        strtok.parse @istream, (v,cb) =>\r\n            # -- initial request -- #\r\n\r\n            if v == undefined\r\n                # we need to examine each byte until we get a FF or ID3\r\n                return FIRST_BYTE\r\n\r\n            # -- ID3v1 tag -- #\r\n\r\n            if @_parsingId3v1\r\n                # our first byte is in @_id3v1_1\r\n                id3 = @parseId3V1(Buffer.concat([@_id3v1_1,v]))\r\n                _emitAndMaybeEnd \"id3v1\", id3\r\n\r\n                @_id3v1_1 = null\r\n                @_parsingId3v1 = false\r\n\r\n                return MPEG_HEADER\r\n\r\n            # -- ID3v2 tag -- #\r\n\r\n            if @_parsingId3v2\r\n                # we'll already have @id3v2 started with versionMajor and\r\n                # our first byte in @_id3v2_1\r\n\r\n                @id3v2.versionMinor = v[0]\r\n                @id3v2.flags = v[1]\r\n\r\n                # calculate the length\r\n                @id3v2.length =  (v[5] & 0x7f) | (( v[4] & 0x7f ) << 7) | (( v[3] & 0x7f ) << 14) | (( v[2] & 0x7f ) << 21)\r\n\r\n                @_parsingId3v2 = false;\r\n                @_finishingId3v2 = true;\r\n                @_id3v2_2 = v;\r\n\r\n                return new strtok.BufferType @id3v2.length\r\n\r\n            if @_finishingId3v2\r\n                # step 3 in the ID3v2 parse...\r\n                b = Buffer.concat([@_id3v2_1, @_id3v2_2, v])\r\n                _emitAndMaybeEnd 'id3v2', b\r\n\r\n                @_finishingId3v2 = false\r\n\r\n                return FIRST_BYTE;\r\n\r\n            # -- frame header -- #\r\n\r\n            if @frameSize == -1 && @frameHeader\r\n                # we're on-schedule now... we've had a valid frame.\r\n                # buffer should be four bytes\r\n                tag = v.toString 'ascii', 0, 3\r\n\r\n                if tag == 'ID3'\r\n                    # parse ID3v2 tag\r\n                    _emitAndMaybeEnd \"debug\", \"got an ID3\"\r\n                    @_parsingId3v2 = true\r\n                    @id3v2 = versionMajor:v[3]\r\n                    @_id3v2_1 = v\r\n\r\n                    return REST_OF_ID3V2_HEADER\r\n\r\n                else if tag == 'TAG'\r\n                    # parse ID3v1 tag\r\n                    _emitAndMaybeEnd \"debug\", \"got a TAG\"\r\n\r\n                    @_id3v1_1 = v\r\n                    @_parsingId3v1 = true\r\n\r\n                    # grab 125 bytes\r\n                    return REST_OF_ID3V1\r\n                else\r\n                    try\r\n                        h = @parseFrame(v)\r\n                    catch e\r\n                        # uh oh...  bad news\r\n                        _emitAndMaybeEnd \"debug\", \"invalid header... \", v, tag, @frameHeader\r\n                        @frameHeader = null\r\n                        return FIRST_BYTE\r\n\r\n                    @frameHeader    = h\r\n                    @frameHeaderBuf = v\r\n                    _emitAndMaybeEnd \"header\", v, h\r\n                    @frameSize = @frameHeader.frameSize\r\n\r\n                    if @frameSize == 1\r\n                        # problem...  just start over\r\n                        _emitAndMaybeEnd \"debug\", \"Invalid frame header: \", h\r\n                        return FIRST_BYTE\r\n                    else\r\n                        return new strtok.BufferType(@frameSize - MPEG_HEADER_LENGTH);\r\n\r\n            # -- first header -- #\r\n\r\n            if @gotFF and @byteTwo\r\n                buf = Buffer.alloc(4)\r\n                buf[0] = 0xFF\r\n                buf[1] = @byteTwo\r\n                buf[2] = v[0]\r\n                buf[3] = v[1]\r\n\r\n                try\r\n                    h = @parseFrame(buf)\r\n\r\n                catch e\r\n                    # invalid header...  chuck everything and try again\r\n                    _emitAndMaybeEnd \"debug\", \"chucking invalid try at header: \", buf\r\n                    @gotFF = false\r\n                    @byteTwo = null\r\n                    return FIRST_BYTE\r\n\r\n                # valid header...  we're on schedule now\r\n                @gotFF = false\r\n                @byteTwo = null\r\n                @beginning = false\r\n\r\n                @frameHeader    = h\r\n                @frameHeaderBuf = buf\r\n                _emitAndMaybeEnd \"header\", h\r\n\r\n                @frameSize = @frameHeader.frameSize\r\n\r\n                if @frameSize == 1\r\n                    # problem...  just start over\r\n                    _emitAndMaybeEnd \"debug\", \"Invalid frame header: \", h\r\n\r\n                    return FIRST_BYTE\r\n                else\r\n                    _emitAndMaybeEnd \"debug\", \"On-tracking with frame of: \", @frameSize - MPEG_HEADER_LENGTH\r\n                    return new strtok.BufferType(@frameSize - MPEG_HEADER_LENGTH);\r\n\r\n            if @gotFF\r\n                if v[0]>>4 >= 0xE\r\n                    @byteTwo = v[0]\r\n\r\n                    # need two more bytes\r\n                    return new strtok.BufferType(2)\r\n                else\r\n                    @gotFF = false\r\n\r\n            if @frameSize == -1 && !@gotFF\r\n                if v[0] == 0xFF\r\n                    # possible start of frame header. need next byte to know more\r\n                    @gotFF = true\r\n                    return FIRST_BYTE\r\n                else if v[0] == 0x49\r\n                    # could be the I in ID3\r\n                    @gotID3 = 1\r\n                    return FIRST_BYTE\r\n\r\n                else if @gotID3 == 1 && v[0] == 0x44\r\n                    @gotID3 = 2\r\n                    return FIRST_BYTE\r\n\r\n                else if @gotID3 == 2 && v[0] == 0x33\r\n                    @gotID3 = 3\r\n                    return FIRST_BYTE\r\n\r\n                else if @gotID3 == 3\r\n                    @_id3v2_1 = Buffer.from([0x49,0x44,0x33,v[0]])\r\n                    @id3v2 = versionMajor:v[0]\r\n                    @_parsingId3v2 = true\r\n                    @gotID3 = 0\r\n                    return REST_OF_ID3V2_HEADER\r\n                else\r\n                    # keep looking\r\n                    return FIRST_BYTE\r\n\r\n            # -- data frame -- #\r\n\r\n            if @frameHeaderBuf\r\n                frame = Buffer.alloc( @frameHeaderBuf.length + v.length )\r\n                @frameHeaderBuf.copy(frame,0)\r\n                v.copy(frame,@frameHeaderBuf.length)\r\n                _emitAndMaybeEnd \"frame\", frame, @frameHeader\r\n\r\n            @frameSize = -1\r\n            return MPEG_HEADER\r\n\r\n    #----------\r\n\r\n    _write: (chunk,encoding,cb) ->\r\n        if @_flushing\r\n            throw new Error \"MP3 write while flushing.\"\r\n\r\n        @istream.emit \"data\", chunk\r\n        cb?()\r\n\r\n    #----------\r\n\r\n    parseId3V1: (id3v1) ->\r\n        id3 = {}\r\n\r\n        _stripNull = (buf) ->\r\n            idx = buf.toJSON().indexOf(0)\r\n            buf.toString \"ascii\", 0, if idx == -1 then buf.length else idx\r\n\r\n        # TAG: 3 bytes\r\n        # title: 30 bytes\r\n        id3.title = _stripNull id3v1.slice(3,33)\r\n\r\n        # artist: 30 bytes\r\n        id3.artist = _stripNull id3v1.slice(33,63)\r\n\r\n        # album: 30 bytes\r\n        id3.album = _stripNull id3v1.slice(63,93)\r\n\r\n        # year: 4 bytes\r\n        id3.year = _stripNull id3v1.slice(93,97)\r\n\r\n        # comment: 28 - 30 bytes\r\n\r\n        if id3v1[125] == 0\r\n            id3.comment = _stripNull id3v1.slice(97,125)\r\n            id3.track = id3v1.readUInt8(126)\r\n        else\r\n            id3.track = null\r\n            id3.comment = _stripNull id3v1.slice(97,127)\r\n\r\n        # genre: 1 byte\r\n        id3.genre = id3v1.readUInt8(127)\r\n\r\n        id3\r\n\r\n    #----------\r\n\r\n    parseFrame: (b) ->\r\n        assert.ok Buffer.isBuffer(b)\r\n\r\n        # -- first twelve bits must be FF[EF] -- #\r\n\r\n        assert.ok ( b[0] == 0xFF && (b[1] >> 4) >= 0xE ), \"Buffer does not start with FF[EF]\"\r\n\r\n        header32 = b.readUInt32BE(0)\r\n\r\n        # -- mpeg id -- #\r\n\r\n        r =\r\n            mpegID:             (header32 >> 19) & 3\r\n            layerID:            (header32 >> 17) & 3\r\n            crc16used:          (header32 & 0x00010000) == 0\r\n            bitrateIndex:       (header32 >> 12) & 0xF\r\n            samplingRateIndex:  (header32 >> 10) & 3\r\n\r\n            padding:            (header32 & 0x00000200) != 0\r\n            privateBitSet:      (header32 & 0x00000100) != 0\r\n            mode:               (header32 >> 6) & 3\r\n            modeExtension:      (header32 >> 4) & 3\r\n            copyrighted:        (header32 & 0x00000008) != 0\r\n            original:           (header32 & 0x00000004) == 0\r\n            emphasis:           header32 & 3\r\n\r\n            # placeholders for mem allocation\r\n            channels:           0\r\n            bitrateKBPS:        0\r\n            mpegName:           \"\"\r\n            layerName:          \"\"\r\n            modeName:           \"\"\r\n            samplingRateHz:     0\r\n            samplesPerFrame:    0\r\n            bytesPerSlot:       0\r\n            frameSizeRaw:       0\r\n            frameSize:          0\r\n            frames_per_sec:     0\r\n            stream_key:         \"\"\r\n\r\n        # now fill in the derived values...\r\n\r\n        r.channels          = if r.mode == MODE_MONO then 1 else 2\r\n        r.bitrateKBPS       = BITRATE_MAP[ r.mpegID ][ r.layerID ][ r.bitrateIndex ]\r\n        r.mpegName          = MPEG_NAME[ r.mpegID ]\r\n        r.layerName         = LAYER_NAME[ r.layerID ]\r\n        r.modeName          = MODE_NAME[ r.mode ]\r\n        r.samplingRateHz    = SAMPLING_RATES[r.samplingRateIndex]\r\n\r\n        if r.mpegID == MPEG2_ID\r\n          r.samplingRateHz  >>= 1 # 16,22,48 kHz\r\n        else if r.mpegID == MPEG25_ID\r\n          r.samplingRateHz  >>= 2 # 8,11,24 kHz\r\n\r\n        if r.layerID == LAYER1_ID\r\n            # layer 1: always 384 samples/frame and 4byte-slots\r\n            r.samplesPerFrame   = 384;\r\n            r.bytesPerSlot      = 4;\r\n            r.frameSizeRaw      = (12 * (r.bitrateKBPS*1000) / (r.samplingRateHz*10) + (r.padding ? 1 : 0)) * 4;\r\n\r\n        else\r\n            # layer 2: always 1152 samples/frame\r\n            # layer 3: MPEG1: 1152 samples/frame, MPEG2/2.5: 576 samples/frame\r\n            r.samplesPerFrame   = if (r.mpegID == MPEG1_ID) || (r.layerID == LAYER2_ID) then 1152 else 576\r\n            r.bytesPerSlot      = 1\r\n            r.frameSizeRaw      = (r.samplesPerFrame / 8) * (r.bitrateKBPS*1000) / r.samplingRateHz + (if r.padding then 1 else 0)\r\n\r\n        # Make the frameSize be the proper floor'd byte length\r\n        r.frameSize = ~~r.frameSizeRaw\r\n\r\n        if (!r.frameSize)\r\n            throw new Error('bad size: ' + r.frameSize)\r\n\r\n        # -- compute StreamMachine-specific header bits -- #\r\n\r\n        r.frames_per_sec    = r.samplingRateHz / r.samplesPerFrame\r\n        r.duration          = (1 / r.frames_per_sec) * 1000\r\n        r.stream_key        = ['mp3',r.samplingRateHz,r.bitrateKBPS,(if r.modeName in [\"Stereo\",\"J-Stereo\"] then \"s\" else \"m\")].join(\"-\")\r\n\r\n        r\r\n"
  ]
}