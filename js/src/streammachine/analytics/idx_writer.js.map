{
  "version": 3,
  "file": "idx_writer.js",
  "sourceRoot": "../../../../src/streammachine/analytics/",
  "sources": [
    "idx_writer.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,SAAA,EAAA;;AAAA,KAAA,GAAQ,OAAA,CAAQ,OAAR,CAAA,CAAiB,yBAAjB;;AAER,MAAM,CAAC,OAAP,GAAuB,YAAN,MAAA,UAAA,QAAwB,OAAA,CAAQ,QAAR,CAAiB,CAAC,SAA1C;EACb,WAAa,GAAA,KAAA,CAAA;;;;IAAC,IAAC,CAAA;IAAG,IAAC,CAAA;IAEf,IAAC,CAAA,GAAG,CAAC,KAAL,CAAW,gBAAX;EAFS;;EAGb,MAAQ,CAAC,KAAD,EAAO,QAAP,EAAgB,EAAhB,CAAA;AACZ,QAAA,IAAA,EAAA,CAAA,EAAA,GAAA,EAAA;IAAQ,IAAC,CAAA,GAAG,CAAC,KAAL,CAAW,CAAA,qBAAA,CAAA,CAAwB,KAAK,CAAC,MAA9B,CAAA,CAAX;IAEA,IAAA,GAAO;IAEP,KAAA,uCAAA;;MACI,IAAI,CAAC,IAAL,CAAU;QAAA,KAAA,EAAM;UAAC,MAAA,EAAO,GAAG,CAAC,KAAZ;UAAmB,KAAA,EAAM,GAAG,CAAC;QAA7B;MAAN,CAAV;MACA,IAAI,CAAC,IAAL,CAAU,GAAG,CAAC,IAAd;IAFJ;WAIA,IAAC,CAAA,EAAE,CAAC,IAAJ,CAAS;MAAA,IAAA,EAAK;IAAL,CAAT,EAAoB,CAAC,GAAD,EAAK,IAAL,CAAA,GAAA;AAC5B,UAAA;MAAY,IAAG,GAAH;QACI,OAAA,GAAU,CAAA,sBAAA,CAAA,CAAyB,KAAK,CAAC,MAA/B,CAAA,OAAA,CAAA,CAA+C,GAA/C,CAAA;QACV,IAAC,CAAA,GAAG,CAAC,KAAL,CAAW,OAAX;AACA,eAAO,EAAA,CAAA,EAHX;;MAKA,IAAC,CAAA,GAAG,CAAC,KAAL,CAAW,CAAA,SAAA,CAAA,CAAY,KAAK,CAAC,MAAlB,CAAA,MAAA,CAAX;MACA,IAAC,CAAA,IAAD,CAAM,MAAN;aACA,EAAA,CAAA;IARgB,CAApB;EATI;;AAJK",
  "sourcesContent": [
    "debug = require(\"debug\")(\"sm:analytics:idx_writer\")\r\n\r\nmodule.exports = class IdxWriter extends require(\"stream\").Writable\r\n    constructor: (@es,@log) ->\r\n        super objectMode:true\r\n        @log.debug \"IdxWriter init\"\r\n    _write: (batch,encoding,cb) ->\r\n        @log.debug \"_write with batch of #{batch.length}\"\r\n\r\n        bulk = []\r\n\r\n        for obj in batch\r\n            bulk.push index:{_index:obj.index, _type:obj.type}\r\n            bulk.push obj.body\r\n\r\n        @es.bulk body:bulk, (err,resp) =>\r\n            if err\r\n                err_str = \"Failed to bulk insert #{batch.length} rows: #{err}\"\r\n                @log.error err_str\r\n                return cb()\r\n\r\n            @log.debug \"Inserted #{batch.length} rows.\"\r\n            @emit \"bulk\"\r\n            cb()\r\n"
  ]
}