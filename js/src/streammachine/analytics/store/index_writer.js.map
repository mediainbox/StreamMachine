{
  "version": 3,
  "file": "index_writer.js",
  "sourceRoot": "../../../../../src/streammachine/analytics/store/",
  "sources": [
    "index_writer.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,aAAA,EAAA;;AAAA,KAAA,GAAQ,OAAA,CAAQ,OAAR,CAAA,CAAiB,yBAAjB;;AAER,MAAM,CAAC,OAAP,GAAuB,gBAAN,MAAA,cAAA,QAA4B,OAAA,CAAQ,QAAR,CAAiB,CAAC,SAA9C;EACb,WAAa,GAAA,QAAA,CAAA;;;;IAAC,IAAC,CAAA;IAAI,IAAC,CAAA;EAAP;;EAGb,MAAQ,CAAC,KAAD,EAAO,QAAP,EAAgB,EAAhB,CAAA;AACZ,QAAA,IAAA,EAAA,CAAA,EAAA,GAAA,EAAA;IAAQ,IAAC,CAAA,MAAM,CAAC,KAAR,CAAc,CAAA,qBAAA,CAAA,CAAwB,KAAK,CAAC,MAA9B,CAAA,CAAd;IAEA,IAAA,GAAO;IAEP,KAAA,uCAAA;;MACI,IAAI,CAAC,IAAL,CAAU;QAAA,KAAA,EAAM;UAAC,MAAA,EAAO,GAAG,CAAC,KAAZ;UAAmB,KAAA,EAAM,GAAG,CAAC;QAA7B;MAAN,CAAV;MACA,IAAI,CAAC,IAAL,CAAU,GAAG,CAAC,IAAd;IAFJ;WAIA,IAAC,CAAA,EAAE,CAAC,IAAJ,CAAS;MAAA,IAAA,EAAK;IAAL,CAAT,EAAoB,CAAC,GAAD,EAAK,IAAL,CAAA,GAAA;AAC5B,UAAA;MAAY,IAAG,GAAH;QACI,OAAA,GAAU,CAAA,sBAAA,CAAA,CAAyB,KAAK,CAAC,MAA/B,CAAA,OAAA,CAAA,CAA+C,GAA/C,CAAA;QACV,IAAC,CAAA,MAAM,CAAC,KAAR,CAAc,OAAd;AACA,eAAO,EAAA,CAAA,EAHX;;MAKA,IAAC,CAAA,MAAM,CAAC,KAAR,CAAc,CAAA,SAAA,CAAA,CAAY,KAAK,CAAC,MAAlB,CAAA,MAAA,CAAd;MACA,IAAC,CAAA,IAAD,CAAM,MAAN;aACA,EAAA,CAAA;IARgB,CAApB;EATI;;AAJK",
  "sourcesContent": [
    "debug = require(\"debug\")(\"sm:analytics:idx_writer\")\r\n\r\nmodule.exports = class EsIndexWriter extends require(\"stream\").Writable\r\n    constructor: (@es, @logger) ->\r\n        super objectMode:true\r\n\r\n    _write: (batch,encoding,cb) ->\r\n        @logger.debug \"_write with batch of #{batch.length}\"\r\n\r\n        bulk = []\r\n\r\n        for obj in batch\r\n            bulk.push index:{_index:obj.index, _type:obj.type}\r\n            bulk.push obj.body\r\n\r\n        @es.bulk body:bulk, (err,resp) =>\r\n            if err\r\n                err_str = \"Failed to bulk insert #{batch.length} rows: #{err}\"\r\n                @logger.error err_str\r\n                return cb()\r\n\r\n            @logger.debug \"Inserted #{batch.length} rows.\"\r\n            @emit \"bulk\"\r\n            cb()\r\n"
  ]
}