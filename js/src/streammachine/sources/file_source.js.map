{
  "version": 3,
  "file": "file_source.js",
  "sourceRoot": "../../../../src/streammachine/sources/",
  "sources": [
    "file_source.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "fs = require \"fs\"\r\n_ = require \"underscore\"\r\n\r\n# FileSource emulates a stream source by reading a local audio file in a\r\n# loop at the correct audio speed.\r\n\r\nmodule.exports = class FileSource extends require(\"./base\")\r\n    TYPE: -> \"File (#{@opts.filePath})\"\r\n\r\n    constructor: (@opts) ->\r\n        super()\r\n\r\n        @connected = false\r\n\r\n        @_file = null\r\n\r\n        @_chunks = []\r\n\r\n        @_emit_pos  = 0\r\n        @_last_ts   = Number(@opts.ts) || null\r\n\r\n        @start() if !@opts.do_not_emit\r\n\r\n        @on \"_chunk\", (chunk) =>\r\n            @_chunks.push chunk\r\n\r\n        @createParser()\r\n\r\n        @parser.once \"header\", (header) =>\r\n            @connected = true\r\n            @emit \"connect\"\r\n\r\n        @parser.once \"end\", =>\r\n# done parsing...\r\n            @parser.removeAllListeners()\r\n            @_current_chunk = null\r\n            @emit \"_loaded\"\r\n\r\n        # pipe our file into the parser\r\n        @_file = fs.createReadStream @opts.filePath\r\n        @_file.pipe(@parser)\r\n\r\n#----------\r\n\r\n    start: ->\r\n        return true if @_int\r\n\r\n        @_int = setInterval =>\r\n            @_emitOnce()\r\n        , @emitDuration * 1000\r\n\r\n        @_emitOnce()\r\n\r\n        true\r\n\r\n#----------\r\n\r\n    stop: ->\r\n        return true if !@_int\r\n\r\n        clearInterval @_int\r\n        @_int = null\r\n\r\n        true\r\n\r\n#----------\r\n\r\n# emit a certain length of time. useful for filling a buffer\r\n    emitSeconds: (secs,wait,cb) ->\r\n        if _.isFunction(wait)\r\n            cb = wait\r\n            wait = null\r\n\r\n        emits = Math.ceil(secs / @emitDuration)\r\n        count = 0\r\n\r\n        if wait\r\n            _f = =>\r\n                @_emitOnce()\r\n                count += 1\r\n\r\n                if count < emits\r\n                    setTimeout _f, wait\r\n                else\r\n                    cb()\r\n\r\n            _f()\r\n        else\r\n            _f = =>\r\n                @_emitOnce()\r\n                count += 1\r\n\r\n                if count < emits\r\n                    process.nextTick => _f()\r\n                else\r\n                    cb()\r\n\r\n            _f()\r\n\r\n#----------\r\n\r\n    _emitOnce: (ts=null) ->\r\n        @_emit_pos = 0 if @_emit_pos >= @_chunks.length\r\n\r\n        chunk = @_chunks[ @_emit_pos ]\r\n\r\n        return if !chunk\r\n\r\n        console.log \"NO DATA!!!! \", chunk if !chunk.data\r\n\r\n        ts = if @_last_ts then @_last_ts + chunk.duration else Number(new Date())\r\n\r\n        @emit \"data\",\r\n            data:       chunk.data\r\n            ts:         new Date(ts)\r\n            duration:   chunk.duration\r\n            streamKey:  @streamKey\r\n            uuid:       @uuid\r\n\r\n        @_last_ts   = ts\r\n        @_emit_pos  = @_emit_pos + 1\r\n\r\n#----------\r\n\r\n    status: ->\r\n        source:     @TYPE?() ? @TYPE\r\n        uuid:       @uuid\r\n        filePath:   @filePath\r\n\r\n#----------\r\n\r\n    disconnect: ->\r\n        if @connected\r\n            @connected = false\r\n            @emit \"disconnect\"\r\n            clearInterval @_int\r\n"
  ]
}