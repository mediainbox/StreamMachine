{
  "version": 3,
  "file": "redis_store.js",
  "sourceRoot": "../../../../src/streammachine/stores/",
  "sources": [
    "redis_store.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,KAAA,EAAA,UAAA,EAAA,GAAA,EAAA,CAAA,EAAA,KAAA,EAAA;;AAAA,CAAA,GAAU,OAAA,CAAQ,YAAR;;AACV,KAAA,GAAU,OAAA,CAAQ,OAAR;;AACV,GAAA,GAAU,OAAA,CAAQ,KAAR;;AACV,KAAA,GAAU,OAAA,CAAQ,OAAR;;AACV,KAAA,GAAU,OAAA,CAAQ,OAAR,CAAA,CAAiB,UAAjB;;AAEV,MAAM,CAAC,OAAP,GAAuB;EAAN,MAAA,WAAA,QAAyB,OAAA,CAAQ,QAAR,CAAiB,CAAC,aAA3C;IAKb,WAAa,CAAC,IAAD,CAAA;AACjB,UAAA;WAAQ,CAAA;MAEA,IAAC,CAAA,OAAD,GAAW,CAAC,CAAC,QAAF,CAAW,IAAX,EAAiB,IAAC,CAAA,cAAlB;MAEX,KAAA,CAAM,CAAA,gBAAA,CAAA,CAAmB,IAAC,CAAA,OAAO,CAAC,MAA5B,CAAA,CAAN;MACA,IAAA,GAAO,GAAG,CAAC,KAAJ,CAAU,IAAC,CAAA,OAAO,CAAC,MAAnB;MACP,IAAC,CAAA,MAAD,GAAU,KAAK,CAAC,YAAN,CAAmB,IAAI,CAAC,IAAL,IAAW,IAA9B,EAAoC,IAAI,CAAC,QAAzC;MAEV,IAAC,CAAA,MAAM,CAAC,IAAR,CAAa,OAAb,EAAsB,CAAA,CAAA,GAAA;AAC9B,YAAA,EAAA,EAAA;QAAY,KAAA,GAAQ,CAAA,CAAA,GAAA;UACJ,IAAC,CAAA,UAAD,GAAc;iBACd,IAAC,CAAA,IAAD,CAAM,WAAN,EAAmB,IAAC,CAAA,MAApB;QAFI,EAApB;;;QAOY,IAAG,IAAI,CAAC,QAAL,IAAiB,IAAI,CAAC,QAAL,KAAiB,GAArC;;UAEI,EAAA,GAAK,MAAA,CAAO,IAAI,CAAC,QAAQ,CAAC,MAAd,CAAqB,CAArB,CAAP;UAEL,IAAG,KAAA,CAAM,EAAN,CAAH;YACI,MAAM,IAAI,KAAJ,CAAU,CAAA,yDAAA,CAAA,CAA4D,IAAI,CAAC,QAAQ,CAAC,MAAd,CAAqB,CAArB,CAA5D,CAAA,CAAA,CAAV,EADV;;UAGA,KAAA,CAAM,CAAA,uBAAA,CAAA,CAA0B,EAA1B,CAAA,CAAN;iBACA,IAAC,CAAA,MAAM,CAAC,MAAR,CAAe,EAAf,EAAmB,CAAC,GAAD,CAAA,GAAA;YACf,IAAmD,GAAnD;cAAA,MAAM,IAAI,KAAJ,CAAU,CAAA,uBAAA,CAAA,CAA0B,GAA1B,CAAA,CAAV,EAAN;;YACA,IAAC,CAAA,GAAD,GAAO;mBAEP,KAAA,CAAA;UAJe,CAAnB,EARJ;SAAA,MAAA;UAcI,IAAC,CAAA,GAAD,GAAO;UACP,KAAA,CAAM,mBAAN;iBACA,KAAA,CAAA,EAhBJ;;MARkB,CAAtB;IATS,CAJjB;;;IA0CI,WAAa,CAAC,GAAD,CAAA;MACT,IAAG,IAAC,CAAA,OAAO,CAAC,GAAZ;eACI,CAAA,CAAA,CAAG,IAAC,CAAA,OAAO,CAAC,GAAZ,CAAA,CAAA,CAAA,CAAmB,GAAnB,CAAA,EADJ;OAAA,MAAA;eAGI,IAHJ;;IADS,CA1CjB;;;IAkDI,cAAgB,CAAC,EAAD,CAAA;MACZ,IAAG,IAAC,CAAA,UAAJ;0CACI,GAAI,IAAC,CAAA,iBADT;OAAA,MAAA;eAGI,IAAC,CAAA,IAAD,CAAM,WAAN,EAAmB,EAAnB,EAHJ;;IADY;;EAnDH;;uBACb,cAAA,GACI;IAAA,MAAA,EAAQ,wBAAR;IACA,GAAA,EAAQ;EADR",
  "sourcesContent": [
    "_       = require 'underscore'\r\nRedis   = require 'redis'\r\nUrl     = require \"url\"\r\nnconf   = require \"nconf\"\r\ndebug   = require(\"debug\")(\"sm:redis\")\r\n\r\nmodule.exports = class RedisStore extends require('events').EventEmitter\r\n    DefaultOptions:\r\n        server: \"redis://localhost:6379\"\r\n        key:    \"StreamMachine\"\r\n\r\n    constructor: (opts) ->\r\n        super()\r\n\r\n        @options = _.defaults opts, @DefaultOptions\r\n\r\n        debug \"init redis with #{@options.server}\"\r\n        info = Url.parse @options.server\r\n        @client = Redis.createClient info.port||6379, info.hostname\r\n\r\n        @client.once \"ready\", =>\r\n            rFunc = =>\r\n                @_connected = true\r\n                @emit \"connected\", @client\r\n\r\n                # see if there's a config to load\r\n                #@_config()\r\n\r\n            if info.pathname && info.pathname != \"/\"\r\n                # see if there's a database number in the path\r\n                db = Number(info.pathname.substr(1))\r\n\r\n                if isNaN(db)\r\n                    throw new Error \"Invalid path in Redis URI spec. Expected db number, got '#{info.pathname.substr(1)}'\"\r\n\r\n                debug \"Redis connecting to DB #{db}\"\r\n                @client.select db, (err) =>\r\n                    throw new Error \"Redis DB select error: #{err}\" if err\r\n                    @_db = db\r\n\r\n                    rFunc()\r\n            else\r\n                @_db = 0\r\n                debug \"Redis using DB 0.\"\r\n                rFunc()\r\n\r\n\r\n    #----------\r\n\r\n    prefixedKey: (key) ->\r\n        if @options.key\r\n            \"#{@options.key}:#{key}\"\r\n        else\r\n            key\r\n\r\n    #----------\r\n\r\n    once_connected: (cb) ->\r\n        if @_connected\r\n            cb?(@client)\r\n        else\r\n            @once \"connected\", cb\r\n"
  ]
}