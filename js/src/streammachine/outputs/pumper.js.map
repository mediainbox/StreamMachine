{
  "version": 3,
  "file": "pumper.js",
  "sourceRoot": "../../../../src/streammachine/outputs/",
  "sources": [
    "pumper.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,UAAA,EAAA,MAAA,EAAA;;AAAA,UAAA,GAAa,OAAA,CAAQ,QAAR;;AAEb,KAAA,GAAQ,OAAA,CAAQ,OAAR,CAAA,CAAiB,mBAAjB;;AAER,MAAM,CAAC,OAAP,GAAuB,SAAN,MAAA,OAAA,QAAqB,WAArB;EACb,WAAa,OAAA,MAAA,CAAA;;IAAC,IAAC,CAAA;IAAO,IAAC,CAAA,YAC3B;;IAGQ,IAAC,CAAA,MAAM,CAAC,MAAR,CAAe,IAAf,EACI;MAAA,UAAA,EAAY,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAhB,IAAwB,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAApD;MACA,IAAA,EAAY,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAD5B;MAEA,QAAA,EAAY;IAFZ,CADJ,EAIE,CAAC,GAAD,QAAA,EAAa,IAAb,CAAA,GAAA;AACV,UAAA;MADe,IAAC,CAAA;MACJ,IAAG,GAAH;QACI,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,MAAV,CAAiB,GAAjB,CAAqB,CAAC,GAAtB,CAA0B,GAA1B;AACA,eAAO,MAFX;;MAIA,OAAA,GACI;QAAA,cAAA,EACO,IAAC,CAAA,MAAM,CAAC,IAAI,CAAC,MAAb,KAAuB,KAA1B,GAA6C,YAA7C,GACQ,IAAC,CAAA,MAAM,CAAC,IAAI,CAAC,MAAb,KAAuB,KAA1B,GAAwC,YAAxC,GACA,SAHT;QAIA,YAAA,EAAwB,OAJxB;QAKA,gBAAA,EAAwB,IAAI,CAAC;MAL7B,EALhB;;MAaY,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,SAAV,CAAoB,GAApB,EAAyB,OAAzB,EAbZ;;MAgBY,IAAC,CAAA,MAAM,CAAC,IAAR,CAAa,IAAC,CAAA,IAAI,CAAC,GAAnB,EAhBZ;;MAmBY,IAAC,CAAA,MAAM,CAAC,EAAR,CAAW,KAAX,EAAoB,CAAA,CAAA,GAAA;eAAG,IAAC,CAAA,UAAD,CAAA;MAAH,CAApB;MACA,IAAC,CAAA,MAAM,CAAC,EAAR,CAAW,OAAX,EAAoB,CAAA,CAAA,GAAA;eAAG,IAAC,CAAA,UAAD,CAAA;MAAH,CAApB;aACA,IAAC,CAAA,MAAM,CAAC,EAAR,CAAW,OAAX,EAAoB,CAAC,GAAD,CAAA,GAAA;QAChB,IAAC,CAAA,MAAM,CAAC,GAAG,CAAC,KAAZ,CAAkB,CAAA,yBAAA,CAAA,CAA4B,GAA5B,CAAA,CAAlB;eACA,IAAC,CAAA,UAAD,CAAA;MAFgB,CAApB;IAtBF,CAJF;EAJS,CAAjB;;;EAoCI,UAAY,CAAA,CAAA;gBAAZ,CAAA,UACI,CAAM,CAAA,CAAA,GAAA;AACd,UAAA,GAAA,EAAA;;WAAmB,CAAE,UAAT,CAAA;;MACA,KAAuB,IAAC,CAAA,MAAM,CAAC,SAA/B;kDAAO,CAAE,GAAT,CAAA,WAAA;;IAFE,CAAN;EADQ;;AArCC",
  "sourcesContent": [
    "BaseOutput = require \"./base\"\r\n\r\ndebug = require(\"debug\")(\"sm:outputs:pumper\")\r\n\r\nmodule.exports = class Pumper extends BaseOutput\r\n    constructor: (@stream,@opts) ->\r\n        super \"pumper\"\r\n\r\n        # figure out what we're pulling\r\n        @stream.listen @,\r\n            offsetSecs: @opts.req.query.from || @opts.req.query.pump\r\n            pump:       @opts.req.query.pump\r\n            pumpOnly:   true\r\n        , (err,@source,info) =>\r\n            if err\r\n                @opts.res.status(500).end err\r\n                return false\r\n\r\n            headers =\r\n                \"Content-Type\":\r\n                    if @stream.opts.format == \"mp3\"         then \"audio/mpeg\"\r\n                    else if @stream.opts.format == \"aac\"    then \"audio/aacp\"\r\n                    else \"unknown\"\r\n                \"Connection\":           \"close\"\r\n                \"Content-Length\":       info.length\r\n\r\n            # write out our headers\r\n            @opts.res.writeHead 200, headers\r\n\r\n            # send our pump buffer to the client\r\n            @source.pipe(@opts.res)\r\n\r\n            # register our various means of disconnection\r\n            @socket.on \"end\",   => @disconnect()\r\n            @socket.on \"close\", => @disconnect()\r\n            @socket.on \"error\", (err) =>\r\n                @stream.log.debug \"Got client socket error: #{err}\"\r\n                @disconnect()\r\n\r\n    #----------\r\n\r\n    disconnect: ->\r\n        super =>\r\n            @source?.disconnect()\r\n            @socket?.end() unless (@socket.destroyed)\r\n"
  ]
}