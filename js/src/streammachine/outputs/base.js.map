{
  "version": 3,
  "file": "base.js",
  "sourceRoot": "../../../../src/streammachine/outputs/",
  "sources": [
    "base.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,UAAA,EAAA,CAAA,EAAA,KAAA,EAAA;;AAAA,CAAA,GAAI,OAAA,CAAQ,YAAR;;AACJ,IAAA,GAAO,OAAA,CAAQ,WAAR;;AAEP,KAAA,GAAQ,OAAA,CAAQ,OAAR,CAAA,CAAiB,iBAAjB;;AAER,MAAM,CAAC,OAAP,GAAuB,aAAN,MAAA,WAAA,QAAyB,OAAA,CAAQ,QAAR,CAAiB,CAAC,aAA3C;EACb,WAAa,CAAC,MAAD,QAAA,MAAA,CAAA;AACjB,QAAA,SAAA,EAAA,GAAA,EAAA;;IAD0B,IAAC,CAAA;IAAQ,IAAC,CAAA;IAG5B,IAAC,CAAA,YAAD,GAAgB,MAFxB;;IAMQ,IAAC,CAAA,MAAD,GAAU;MAAA,MAAA,EAAO;IAAP;IACV,IAAC,CAAA,MAAD,GAAU;IAEV,IAAG,IAAC,CAAA,IAAI,CAAC,GAAN,IAAa,IAAC,CAAA,IAAI,CAAC,GAAtB;;MAGI,IAAC,CAAA,MAAM,CAAC,EAAR,GAAsB,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,GAF5C;;MAKY,IAAC,CAAA,MAAM,CAAC,IAAR,GAAsB,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC;MAChC,IAAC,CAAA,MAAM,CAAC,EAAR,GAAsB,CAAC,CAAC,OAAF,CAAU,CAAC,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAjB,6CAAsC,CAAE,YAAF,UAAtC,CAAV,CAAiE,CAAC,IAAlE,CAAuE,KAAvE;MACtB,IAAC,CAAA,MAAM,CAAC,OAAR,GAAsB,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC;MAEhC,IAAC,CAAA,MAAM,CAAC,YAAR,GAA0B,KATtC;;;MAWY,IAAC,CAAA,MAAM,CAAC,UAAR,GACO,CAAA,SAAA,gDAA6B,CAAE,uBAAF,UAA7B,CAAH,GAChB,CAAoB,IAAC,CAAA,MAAM,CAAC,YAAR,GAAuB,KAA3C,EACoB,SADpB,CADgB,GAGQ,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,UAAnB,GAED,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,UAFf,GAKD,IAAI,CAAC,EAAL,CAAA;MAER,IAAC,CAAA,MAAD,GAAU,IAAC,CAAA,IAAI,CAAC,GAAG,CAAC,WAvBxB;KAAA,MAAA;MA0BI,IAAC,CAAA,MAAD,GAAU,IAAC,CAAA,IAAI,CAAC;MAChB,IAAC,CAAA,MAAD,GAAU,IAAC,CAAA,IAAI,CAAC,OA3BpB;;EAVS,CAAjB;;;EAyCI,UAAY,CAAC,EAAD,CAAA;IACR,IAAG,CAAC,IAAC,CAAA,YAAL;MACI,IAAC,CAAA,YAAD,GAAgB;MAChB,IAAC,CAAA,IAAD,CAAM,YAAN;wCACA,cAHJ;;EADQ;;AA1CC",
  "sourcesContent": [
    "_ = require \"underscore\"\r\nuuid = require \"node-uuid\"\r\n\r\ndebug = require('debug')('sm:outputs:base')\r\n\r\nmodule.exports = class BaseOutput extends require(\"events\").EventEmitter\r\n    constructor: (output, @stream, @opts) ->\r\n        super()\r\n\r\n        @disconnected = false\r\n\r\n        # turn @opts into @client\r\n\r\n        @client = output:output\r\n        @socket = null\r\n\r\n        if @opts.req && @opts.res\r\n            # -- startup mode...  sending headers -- #\r\n\r\n            @client.ip          = @opts.req.ip\r\n\r\n            #@client.ip          = @opts.req.connection.remoteAddress\r\n            @client.path        = @opts.req.url\r\n            @client.ua          = _.compact([@opts.req.query.ua, @opts.req.headers?['user-agent']]).join(\" | \")\r\n            @client.user_id     = @opts.req.user_id\r\n\r\n            @client.pass_session    = true\r\n\r\n            @client.session_id      =\r\n                if a_session = @opts.req.headers?['x-playback-session-id']\r\n                    @client.pass_session = false\r\n                    a_session\r\n                else if @opts.req.query.session_id\r\n                    # use passed-in session id\r\n                    @opts.req.query.session_id\r\n                else\r\n                    # generate session id\r\n                    uuid.v4()\r\n\r\n            @socket = @opts.req.connection\r\n\r\n        else\r\n            @client = @opts.client\r\n            @socket = @opts.socket\r\n\r\n    #----------\r\n\r\n    disconnect: (cb) ->\r\n        if !@disconnected\r\n            @disconnected = true\r\n            @emit \"disconnect\"\r\n            cb?()\r\n"
  ]
}