{
  "version": 3,
  "file": "index.js",
  "sourceRoot": "../../../../src/streammachine/logger/",
  "sources": [
    "index.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "_ = require \"underscore\"\r\nStackdriverLogging = require('@google-cloud/logging-winston').LoggingWinston\r\ncustomTransports = require \"./transports\";\r\n\r\nwinston = require \"winston\"\r\n{ combine, timestamp, label, prettyPrint } = winston.format;\r\n\r\ndebug = require(\"debug\")(\"sm:logger\")\r\n\r\nmodule.exports = createLogger: (config) ->\r\n    CustomLevels:\r\n        error:          80\r\n        alert:          75\r\n        event:          70\r\n        info:           60\r\n        request:        40\r\n        interaction:    30\r\n        minute:         30\r\n        debug:          10\r\n        silly:          5\r\n\r\n    debug \"create logger (mode: #{config.mode}, env: #{config.env})\"\r\n\r\n    transports = []\r\n\r\n    # -- debug -- #\r\n\r\n    transports.push new customTransports.DebugTransport\r\n\r\n    # -- stdout -- #\r\n\r\n    if config.stdout\r\n        debug \"adding console transport\"\r\n        transports.push new winston.transports.Console(\r\n            colorize: true,\r\n            prettyPrint: true,\r\n            timestamp: true\r\n        )\r\n\r\n    ###\r\n    transports.push new customTransports.ConsoleTransport\r\n        level:      config.stdout?.level        || \"debug\"\r\n        colorize:   config.stdout?.colorize     || false\r\n        timestamp:  config.stdout?.timestamp    || false\r\n        ignore:     config.stdout?.ignore       || \"\"\r\n    ###\r\n\r\n    # -- JSON -- #\r\n\r\n    if config.json?.file\r\n        debug \"Setting up JSON logger with \", config.json\r\n        transports.push new (winston.transports.File)\r\n            level:      config.json.level || \"interaction\"\r\n            timestamp:  true\r\n            filename:   config.json.file\r\n            json:       true\r\n            options:\r\n                flags: 'a'\r\n                highWaterMark: 24\r\n\r\n\r\n    # -- Stackdriver -- #\r\n\r\n    if config.stackdriver? || 1\r\n        debug \"adding stackdriver transport\"\r\n        transports.push new StackdriverLogging(\r\n            name: \"stackdriver\"\r\n            logname: 'stream_machine'\r\n            logName: 'stream_machine'\r\n            prefix: config.mode\r\n            labels:\r\n                    mode: config.mode,\r\n                    env: config.env\r\n        )\r\n\r\n\r\n    # create a winston logger for this instance\r\n    logger = winston.createLogger\r\n        level: 'debug'\r\n        #levels: winston.config.syslog.levels\r\n        transports: transports\r\n        #levels:@CustomLevels\r\n        #, rewriters:[@RequestRewriter]\r\n\r\n    winston.addColors(winston.config.npm.levels)\r\n\r\n    return logger\r\n\r\n    #----------\r\n\r\n    # connect to our events and proxy interaction and request events through\r\n    # to a master server over WebSockets\r\n    proxyToMaster: (sock) ->\r\n        @logger.remove(@logger.transports['socket']) if @logger.transports['socket']\r\n        @logger.add (new Logger.SocketLogger sock, level:\"interaction\"), {}, true if sock\r\n\r\n    #----------\r\n\r\n    class @Child\r\n        constructor: (@parent,@opts) ->\r\n            _(['log', 'profile', 'startTimer'].concat(Object.keys(@parent.logger.levels))).each (k) =>\r\n                @[k] = (args...) =>\r\n                    if _.isObject(args[args.length-1])\r\n                        args[args.length-1] = _.extend {}, args[args.length-1], @opts\r\n                    else\r\n                        args.push _.clone(@opts)\r\n\r\n                    @parent[k].apply @, args\r\n\r\n            @logger = @parent.logger\r\n            @child = (opts={}) -> new Logger.Child(@parent,_.extend({},@opts,opts))\r\n\r\n        proxyToMaster: (sock) ->\r\n            @parent.proxyToMaster(sock)\r\n\r\n    #----------\r\n"
  ]
}