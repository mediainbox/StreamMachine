{
  "version": 3,
  "file": "index.js",
  "sourceRoot": "../../../../src/streammachine/logger/",
  "sources": [
    "index.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "_ = require \"underscore\"\r\nStackdriverLogging = require('@google-cloud/logging-winston').LoggingWinston\r\nCustomTransports = require \"./transports\";\r\ncluster = require('cluster');\r\n\r\nwinston = require \"winston\"\r\n{ combine, timestamp, label, prettyPrint, json } = winston.format;\r\n\r\ndebug = require(\"debug\")(\"sm:logger\")\r\n\r\nmodule.exports = createLogger: (config) ->\r\n    CustomLevels:\r\n        error:          80\r\n        alert:          75\r\n        event:          70\r\n        info:           60\r\n        request:        40\r\n        interaction:    30\r\n        minute:         30\r\n        debug:          10\r\n        silly:          5\r\n\r\n    debug \"create logger (mode: #{config.mode}, env: #{config.env})\"\r\n\r\n    transports = []\r\n\r\n    # -- debug -- #\r\n\r\n    transports.push new CustomTransports.DebugTransport\r\n\r\n    # -- stdout -- #\r\n\r\n    if false and config.log.stdout\r\n        debug \"adding console transport\"\r\n        transports.push new winston.transports.Console()\r\n        ###\r\n        level:      config.stdout?.level        || \"debug\"\r\n        colorize:   config.stdout?.colorize     || false\r\n        timestamp:  config.stdout?.timestamp    || false\r\n        ignore:     config.stdout?.ignore       || \"\"\r\n        ###\r\n\r\n    # -- JSON -- #\r\n\r\n    if config.json?.file\r\n        debug \"Setting up JSON logger with \", config.json\r\n        transports.push new (winston.transports.File)\r\n            level:      config.json.level || \"interaction\"\r\n            timestamp:  true\r\n            filename:   config.json.file\r\n            json:       true\r\n            options:\r\n                flags: 'a'\r\n                highWaterMark: 24\r\n\r\n\r\n    # -- Stackdriver -- #\r\n\r\n    if config.stackdriver?\r\n        debug \"adding stackdriver transport\"\r\n        transports.push new StackdriverLogging(\r\n            name: \"stackdriver\"\r\n            logname: 'stream_machine'\r\n            logName: 'stream_machine'\r\n            prefix: config.mode\r\n            labels:\r\n                    mode: config.mode\r\n                    env: config.env\r\n        )\r\n\r\n\r\n    addMetadata = winston.format((info) ->\r\n        info.workerId = cluster.isWorker && cluster.worker.id\r\n        return info\r\n    )\r\n\r\n    # create a winston logger for this instance\r\n    logger = winston.createLogger\r\n        format: combine(\r\n            addMetadata(),\r\n            json()\r\n        )\r\n        level: 'debug' # TODO\r\n        transports: transports\r\n\r\n    winston.addColors(winston.config.npm.levels)\r\n\r\n    return logger\r\n"
  ]
}