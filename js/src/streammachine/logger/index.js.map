{
  "version": 3,
  "file": "index.js",
  "sourceRoot": "../../../../src/streammachine/logger/",
  "sources": [
    "index.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "_ = require \"underscore\"\r\nwinston = require \"winston\"\r\nLoggingWinston = require('@google-cloud/logging-winston').LoggingWinston\r\ncustomTransports = require \"./transports\";\r\n\r\nfs          = require \"fs\"\r\npath        = require \"path\"\r\n\r\ndebug = require(\"debug\")(\"sm:logger\")\r\n\r\nmodule.exports = class LogController\r\n    CustomLevels:\r\n        error:          80\r\n        alert:          75\r\n        event:          70\r\n        info:           60\r\n        request:        40\r\n        interaction:    30\r\n        minute:         30\r\n        debug:          10\r\n        silly:          5\r\n\r\n    constructor: (config, mode, env) ->\r\n        console.log \"[logging] configure logger, mode: #{mode}, env: #{env}\"\r\n\r\n        transports = []\r\n\r\n        # -- debug -- #\r\n\r\n        transports.push new customTransports.DebugTransport level:\"silly\"\r\n\r\n        # -- stdout -- #\r\n\r\n        if config.stdout\r\n            console.log \"[logging] adding console transport\"\r\n            transports.push new customTransports.ConsoleTransport\r\n                level:      config.stdout?.level        || \"debug\"\r\n                colorize:   config.stdout?.colorize     || false\r\n                timestamp:  config.stdout?.timestamp    || false\r\n                ignore:     config.stdout?.ignore       || \"\"\r\n\r\n        # -- JSON -- #\r\n\r\n        if config.json?.file\r\n            console.log \"Setting up JSON logger with \", config.json\r\n            transports.push new (winston.transports.File)\r\n                level:      config.json.level || \"interaction\"\r\n                timestamp:  true\r\n                filename:   config.json.file\r\n                json:       true\r\n                options:\r\n                    flags: 'a'\r\n                    highWaterMark: 24\r\n\r\n        # -- W3C -- #\r\n\r\n        if config.w3c?.file\r\n            # set up W3C-format logging\r\n            transports.push new customTransports.W3CLogger\r\n                level:      config.w3c.level || \"request\"\r\n                filename:   config.w3c.file\r\n\r\n\r\n        # -- Stackdriver -- #\r\n\r\n        if config.stackdriver? || 1\r\n            console.log \"[logging] adding stackdriver transport\"\r\n            transports.push new LoggingWinston(\r\n                name: \"stackdriver\"\r\n                logname: 'stream_machine'\r\n                logName: 'stream_machine'\r\n                prefix: mode\r\n                labels:\r\n                        mode: mode,\r\n                        env: env\r\n\r\n            )\r\n\r\n\r\n        # create a winston logger for this instance\r\n        @logger = new (winston.Logger) transports:transports, levels:@CustomLevels #, rewriters:[@RequestRewriter]\r\n        @logger.extend(@)\r\n\r\n    #----------\r\n\r\n    # returns a logger that will automatically merge in the given data\r\n    child: (opts={}) -> new LogController.Child(@,opts)\r\n\r\n    #----------\r\n\r\n    # connect to our events and proxy interaction and request events through\r\n    # to a master server over WebSockets\r\n    proxyToMaster: (sock) ->\r\n        @logger.remove(@logger.transports['socket']) if @logger.transports['socket']\r\n        @logger.add (new LogController.SocketLogger sock, level:\"interaction\"), {}, true if sock\r\n\r\n    #----------\r\n\r\n    class @Child\r\n        constructor: (@parent,@opts) ->\r\n            _(['log', 'profile', 'startTimer'].concat(Object.keys(@parent.logger.levels))).each (k) =>\r\n                @[k] = (args...) =>\r\n                    if _.isObject(args[args.length-1])\r\n                        args[args.length-1] = _.extend {}, args[args.length-1], @opts\r\n                    else\r\n                        args.push _.clone(@opts)\r\n\r\n                    @parent[k].apply @, args\r\n\r\n            @logger = @parent.logger\r\n            @child = (opts={}) -> new LogController.Child(@parent,_.extend({},@opts,opts))\r\n\r\n        proxyToMaster: (sock) ->\r\n            @parent.proxyToMaster(sock)\r\n\r\n    #----------\r\n"
  ]
}