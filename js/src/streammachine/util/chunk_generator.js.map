{
  "version": 3,
  "file": "chunk_generator.js",
  "sourceRoot": "../../../../src/streammachine/util/",
  "sources": [
    "chunk_generator.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "_ = require \"underscore\"\r\n\r\ndebug = require(\"debug\")(\"sm:util:chunk_generator\")\r\n\r\n# Generate fake audio chunks for testing\r\n\r\nmodule.exports = class ChunkGenerator extends require(\"stream\").Readable\r\n    constructor: (@start_ts,@chunk_duration) ->\r\n        super objectMode:true\r\n\r\n        @_count_f   = 0\r\n        @_count_b   = 1\r\n\r\n\r\n    skip_forward: (count,cb) ->\r\n        @_count_f += count\r\n        cb?()\r\n\r\n    skip_backward: (count,cb) ->\r\n        @_count_b += count\r\n        cb?()\r\n\r\n    ts: ->\r\n        forward:    new Date( Number(@start_ts) + (@_count_f) * @chunk_duration )\r\n        backward:   new Date( Number(@start_ts) + (@_count_b) * @chunk_duration )\r\n\r\n    forward: (count,cb) ->\r\n        af = _.after count, =>\r\n            @_count_f += count\r\n            @emit \"readable\"\r\n            debug \"Forward emit #{count} chunks. Finished at #{ new Date( Number(@start_ts) + (@_count_f) * @chunk_duration ) }\"\r\n            cb?()\r\n\r\n        _(count).times (c) =>\r\n            chunk =\r\n                ts:         new Date( Number(@start_ts) + (@_count_f+c) * @chunk_duration )\r\n                duration:   @chunk_duration\r\n                data:       Buffer.alloc(0)\r\n\r\n            @push chunk\r\n            af()\r\n\r\n    backward: (count,cb) ->\r\n        af = _.after count, =>\r\n            @_count_b += count\r\n            @emit \"readable\"\r\n            debug \"Backward emit #{count} chunks. Finished at #{ new Date( Number(@start_ts) + (@_count_b) * @chunk_duration ) }\"\r\n            cb?()\r\n\r\n        _(count).times (c) =>\r\n            chunk =\r\n                ts:         new Date( Number(@start_ts) - (@_count_b+c) * @chunk_duration )\r\n                duration:   @chunk_duration\r\n                data:       Buffer.alloc(0)\r\n\r\n            @push chunk\r\n            af()\r\n\r\n    end: ->\r\n        @push null\r\n\r\n    _read: (size) ->\r\n        # do nothing?\r\n"
  ]
}