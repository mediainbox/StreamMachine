{
  "version": 3,
  "file": "fake_transcoder.js",
  "sourceRoot": "../../../../src/streammachine/util/",
  "sources": [
    "fake_transcoder.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,cAAA,EAAA,KAAA,EAAA,OAAA,EAAA;;AAAA,OAAA,GAAU,OAAA,CAAQ,SAAR;;AACV,KAAA,GAAQ,OAAA,CAAQ,OAAR,CAAA,CAAiB,yBAAjB;;AACR,EAAA,GAAK,OAAA,CAAQ,IAAR;;AAEL,MAAM,CAAC,OAAP,GAAuB,iBAAN,MAAA,eAAA,QAA6B,OAAA,CAAQ,QAAR,CAAiB,CAAC,aAA/C;EACb,WAAa,KAAA,WAAA,CAAA;AACjB,QAAA;;IADkB,IAAC,CAAA;IAAK,IAAC,CAAA;IAGjB,IAAC,CAAA,GAAD,GAAO,OAAA,CAAA;IAEP,IAAC,CAAA,GAAG,CAAC,GAAL,CAAS,WAAT,EAAsB,CAAC,GAAD,EAAK,GAAL,CAAA,GAAA;AAC9B,UAAA,CAAA,EAAA,CAAA,EAAA,GAAA,EAAA,CAAA,EAAA;MAAY,GAAA,GAAM,GAAG,CAAC,KAAK,CAAC,KAAD;MACf,GAAA,GAAM,GAAG,CAAC,KAAK,CAAC,KAAD;MAEf,IAA0D,CAAC,GAAD,IAAQ,CAAC,GAAnE;AAAA,eAAO,GAAG,CAAC,MAAJ,CAAW,GAAX,CAAe,CAAC,GAAhB,CAAoB,2BAApB,EAAP;;MAEA,KAAA,CAAM,CAAA,4BAAA,CAAA,CAA+B,GAA/B,CAAA,EAAA,CAAA,CAAuC,GAAvC,CAAA,CAAN;MAEA,IAAC,CAAA,IAAD,CAAM,SAAN,EAAiB;QAAA,GAAA,EAAI,GAAJ;QAAS,GAAA,EAAI;MAAb,CAAjB;AAEA;;QAEI,CAAA,GAAI,CAAA,CAAA,CAAG,IAAC,CAAA,SAAJ,CAAA,CAAA,CAAA,CAAiB,GAAjB,CAAA,IAAA;QACJ,KAAA,CAAM,CAAA,mBAAA,CAAA,CAAsB,CAAtB,CAAA,CAAN;QACA,CAAA,GAAI,EAAE,CAAC,gBAAH,CAAoB,CAApB;QACJ,CAAC,CAAC,IAAF,CAAO,GAAG,CAAC,MAAJ,CAAW,GAAX,CAAe,CAAC,IAAhB,CAAqB,YAArB,CAAP;eAEA,CAAC,CAAC,IAAF,CAAO,KAAP,EAAc,CAAA,CAAA,GAAA;iBACV,KAAA,CAAM,0BAAN;QADU,CAAd,EAPJ;OAUA,aAAA;QAAM;eACF,GAAG,CAAC,MAAJ,CAAW,GAAX,CAAe,CAAC,GAAhB,CAAoB,CAAA,4BAAA,CAAA,CAA+B,CAA/B,CAAA,CAApB,EADJ;;IApBkB,CAAtB;IAuBA,CAAA,GAAI,IAAC,CAAA,GAAG,CAAC,MAAL,CAAY,IAAC,CAAA,IAAb;IAEJ,IAA4B,IAAC,CAAA,IAAD,KAAS,CAArC;MAAA,IAAC,CAAA,IAAD,GAAQ,CAAC,CAAC,OAAF,CAAA,CAAW,CAAC,KAApB;;EA9BS;;AADA",
  "sourcesContent": [
    "express = require \"express\"\r\ndebug = require(\"debug\")(\"sm:util:fake_transcoder\")\r\nfs = require \"fs\"\r\n\r\nmodule.exports = class FakeTranscoder extends require(\"events\").EventEmitter\r\n    constructor: (@port,@files_dir) ->\r\n        super()\r\n\r\n        @app = express()\r\n\r\n        @app.get \"/encoding\", (req,res) =>\r\n            key = req.query[\"key\"]\r\n            uri = req.query[\"uri\"]\r\n\r\n            return res.status(400).end \"Key and URI are required.\" if !key || !uri\r\n\r\n            debug \"Fake Transcoder request for #{key}: #{uri}\"\r\n\r\n            @emit \"request\", key:key, uri:uri\r\n\r\n            try\r\n                # FIXME: recognize extension to support aac\r\n                f = \"#{@files_dir}/#{key}.mp3\"\r\n                debug \"Attempting to send #{f}\"\r\n                s = fs.createReadStream f\r\n                s.pipe(res.status(200).type('audio/mpeg'))\r\n\r\n                s.once \"end\", =>\r\n                    debug \"Transcoder response sent\"\r\n\r\n            catch e\r\n                res.status(500).end \"Failed to open static file: #{e}\"\r\n\r\n        s = @app.listen @port\r\n\r\n        @port = s.address().port if @port == 0\r\n\r\n"
  ]
}