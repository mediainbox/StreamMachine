{
  "version": 3,
  "file": "test_preroll_server.js",
  "sourceRoot": "../../util/",
  "sources": [
    "test_preroll_server.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,KAAA,EAAA,aAAA,EAAA,OAAA,EAAA,EAAA,EAAA,IAAA,EAAA;;AAAA,OAAA,GAAU,OAAA,CAAQ,SAAR;;AACV,EAAA,GAAK,OAAA,CAAQ,IAAR;;AACL,IAAA,GAAO,OAAA,CAAQ,MAAR;;AAEP,KAAA,GAAQ,QAAA,CAAC,IAAD,CAAA;SAAU,IAAI,CAAC,OAAL,CAAa,SAAb,EAAuB,IAAvB,EAA4B,IAA5B;AAAV;;AAEF,gBAAN,MAAA,cAAA;EACI,WAAa,MAAA,QAAa,IAAb,CAAA;IAAC,IAAC,CAAA;IAAM,IAAC,CAAA;IAClB,IAAC,CAAA,GAAD,GAAO,OAAA,CAAA;IACP,IAAC,CAAA,GAAG,CAAC,GAAL,CAAS,kBAAT,EAA6B,CAAC,GAAD,EAAK,GAAL,EAAS,IAAT,CAAA,GAAA;AACrC,UAAA,CAAA,EAAA,GAAA,EAAA;MAAY,OAAO,CAAC,GAAR,CAAY,CAAA,oBAAA,CAAA,CAAwB,GAAG,CAAC,IAA5B,CAAA,CAAZ;MACA,IAAG,CAAA,qDAA8B,CAAG,GAAG,CAAC,KAAJ,CAAU,WAAV,CAAH,UAAjC;QACI,IAAG,IAAC,CAAA,GAAJ;UAEI,GAAG,CAAC,MAAJ,CAAW,cAAX,EAA2B,YAA3B;UACA,GAAG,CAAC,MAAJ,CAAW,GAAX;UAEA,MAAA,GAAS,EAAE,CAAC,gBAAH,CAAoB,CAApB;iBACT,MAAM,CAAC,IAAP,CAAY,GAAZ,EANJ;SAAA,MAAA;;iBASI,UAAA,CAAW,CAAA,CAAA,GAAA,EAAA;;mBAEP,GAAG,CAAC,GAAJ,CAAA;UAFO,CAAX,EAGE,IAHF,EATJ;SADJ;OAAA,MAAA;eAeI,IAAA,CAAA,EAfJ;;IAFyB,CAA7B;IAmBA,IAAC,CAAA,GAAG,CAAC,GAAL,CAAS,GAAT,EAAc,CAAC,GAAD,EAAK,GAAL,EAAS,IAAT,CAAA,GAAA;MACV,OAAO,CAAC,GAAR,CAAY,CAAA,mBAAA,CAAA,CAAsB,GAAG,CAAC,IAA1B,CAAA,CAAZ;aACA,IAAA,CAAA;IAFU,CAAd;IAIA,IAAC,CAAA,GAAG,CAAC,MAAL,CAAY,OAAO,CAAC,IAAI,CAAC,CAAD,CAAxB;EAzBS;;EA2Bb,MAAQ,CAAA,CAAA;IACJ,IAAC,CAAA,GAAD,GAAO,CAAC,IAAC,CAAA;WACT,OAAO,CAAC,GAAR,CAAY,CAAA,cAAA,CAAA,CAAqB,IAAC,CAAA,GAAJ,GAAa,IAAb,GAAuB,KAAzC,CAAA,CAAZ;EAFI;;AA5BZ;;AAgCA,GAAA,GAAM,IAAI,aAAJ,CACF;EAAA,IAAA,EACI;IAAA,iBAAA,EAAmB,KAAA,CAAM,0CAAN;EAAnB;AADJ,CADE;;AAIN,OAAO,CAAC,EAAR,CAAW,SAAX,EAAsB,QAAA,CAAA,CAAA;SAClB,GAAG,CAAC,MAAJ,CAAA;AADkB,CAAtB;;AAGA,OAAO,CAAC,GAAR,CAAY,CAAA,OAAA,CAAA,CAAU,OAAO,CAAC,GAAlB,CAAA,CAAZ",
  "sourcesContent": [
    "express = require \"express\"\r\nfs = require \"fs\"\r\npath = require \"path\"\r\n\r\n$file = (file) -> path.resolve(__dirname,\"..\",file)\r\n\r\nclass PrerollServer\r\n    constructor: (@files,@_on=true) ->\r\n        @app = express()\r\n        @app.get \"/:key/:streamkey\", (req,res,next) =>\r\n            console.log \"Preroll request for #{ req.path }\"\r\n            if f = @files[ req.param(\"key\") ]?[ req.param(\"streamkey\") ]\r\n                if @_on\r\n\r\n                    res.header \"Content-Type\", \"audio/mpeg\"\r\n                    res.status 200\r\n\r\n                    stream = fs.createReadStream f\r\n                    stream.pipe(res)\r\n                else\r\n                    # what should we do to test a bad server?\r\n                    setTimeout =>\r\n                        # end unexpectedly\r\n                        res.end()\r\n                    , 3000\r\n            else\r\n                next()\r\n\r\n        @app.get \"*\", (req,res,next) =>\r\n            console.log \"Invalid request to #{req.path}\"\r\n            next()\r\n\r\n        @app.listen process.argv[2]\r\n\r\n    toggle: ->\r\n        @_on = !@_on\r\n        console.log \"Responses are #{ if @_on then \"on\" else \"off\" }\"\r\n\r\npre = new PrerollServer\r\n    test:\r\n        \"mp3-44100-128-m\": $file \"test/files/mp3/tone250Hz-44100-128-m.mp3\"\r\n\r\nprocess.on \"SIGUSR2\", ->\r\n    pre.toggle()\r\n\r\nconsole.log \"PID is #{process.pid}\"\r\n"
  ]
}