{
  "version": 3,
  "file": "inspect_rewind.js",
  "sourceRoot": "../../util/",
  "sources": [
    "inspect_rewind.coffee"
  ],
  "names": [],
  "mappings": "AAAA,IAAA,MAAA,EAAA,YAAA,EAAA,QAAA,EAAA,EAAA,EAAA,CAAA,EAAA,GAAA,EAAA,QAAA,EAAA,IAAA,EAAA,MAAA,EAAA;;AAAA,YAAA,GAAkB,OAAA,CAAQ,oCAAR;;AAClB,MAAA,GAAkB,OAAA,CAAQ,6BAAR;;AAElB,IAAA,GAAO,OAAA,CAAQ,MAAR;;AACP,EAAA,GAAK,OAAA,CAAQ,IAAR;;AAEL,QAAA,GAAW,OAAO,CAAC,IAAI,CAAC,CAAD;;AAEvB,IAAG,CAAC,QAAJ;EACI,OAAO,CAAC,KAAR,CAAc,0BAAd;EACA,OAAO,CAAC,IAAR,CAAa,CAAb,EAFJ;;;AAIA,MAAA,GAAS;;AACT,IAAG,QAAA,KAAY,GAAf;EACE,MAAA,GAAS,OAAO,CAAC,MADnB;CAAA,MAAA;EAIE,QAAA,GAAW,IAAI,CAAC,OAAL,CAAa,QAAb;EAEX,IAAG,CAAC,EAAE,CAAC,UAAH,CAAc,QAAd,CAAJ;IACI,OAAO,CAAC,KAAR,CAAc,iBAAd;IACA,OAAO,CAAC,IAAR,CAAa,CAAb,EAFJ;;EAIA,MAAA,GAAS,EAAE,CAAC,gBAAH,CAAoB,QAApB,EAVX;;;AAYA,GAAA,GAAU,IAAI,MAAJ,CAAW;EAAA,MAAA,EAAO;AAAP,CAAX;;AACV,MAAA,GAAU,IAAI,YAAJ,CAAiB;EAAA,OAAA,EAAQ,MAAR;EAAgB,KAAA,EAAM,EAAtB;EAA0B,GAAA,EAAI,WAA9B;EAA2C,GAAA,EAAI;AAA/C,CAAjB;;AAGV,MAAM,CAAC,IAAP,CAAY,QAAZ,EAAsB,QAAA,CAAC,MAAD,CAAA;SACpB,OAAO,CAAC,GAAR,CAAY,wBAAZ,EAAsC,MAAtC;AADoB,CAAtB,EA7BA;;;;AAmCA,QAAA,GAAW;;AACX,CAAA,GAAI;;AACJ,MAAM,CAAC,EAAP,CAAU,QAAV,EAAoB,QAAA,CAAC,KAAD,CAAA;AACpB,MAAA;EAAE,IAAG,QAAH;IACE,WAAA,GAAc,MAAA,CAAO,KAAK,CAAC,EAAb,CAAA,GAAmB,KAAK,CAAC,SAA3C;;IAEI,IAAG,CAAC,MAAA,CAAO,QAAQ,CAAC,EAAhB,CAAA,GAAsB,EAAtB,GAA2B,WAA5B,CAAA,IAA4C,CAAC,WAAA,GAAc,MAAA,CAAO,QAAQ,CAAC,EAAhB,CAAA,GAAsB,EAArC,CAA/C;MACI,OAAO,CAAC,GAAR,CAAY,CAAA,KAAA,CAAA,CAAQ,CAAR,CAAA,OAAA,CAAA,CAAmB,QAAQ,CAAC,EAA5B,CAAA,cAAA,CAAA,CAAgD,IAAI,IAAJ,CAAS,WAAT,CAAhD,CAAA,YAAA,CAAA,CAAsF,MAAA,CAAO,WAAA,GAAc,QAAQ,CAAC,EAA9B,CAAtF,CAAA,CAAZ,EADJ;KAHF;;EAMA,QAAA,GAAW;SACX,CAAA,IAAK;AARa,CAApB;;AAWA,MAAM,CAAC,UAAP,CAAkB,MAAlB,EAA0B,CAAC,GAAD,EAAK,KAAL,CAAA,GAAA;SACtB,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,KAArC;AADsB,CAA1B",
  "sourcesContent": [
    "RewindBuffer    = require \"../src/streammachine/rewind_buffer\"\r\nLogger          = require \"../src/streammachine/logger\"\r\n\r\npath = require \"path\"\r\nfs = require \"fs\"\r\n\r\nfilepath = process.argv[2]\r\n\r\nif !filepath\r\n    console.error \"A file path is required.\"\r\n    process.exit(1)\r\n\r\nstream = null\r\nif filepath == \"-\"\r\n  stream = process.stdin\r\n\r\nelse\r\n  filepath = path.resolve(filepath)\r\n\r\n  if !fs.existsSync(filepath)\r\n      console.error \"File not found.\"\r\n      process.exit(1)\r\n\r\n  stream = fs.createReadStream filepath\r\n\r\nlog     = new Logger stdout:true\r\nrewind  = new RewindBuffer seconds:999999, burst:30, key:\"inspector\", log:log\r\n\r\n\r\nrewind.once \"header\", (header) ->\r\n  console.log \"Rewind Buffer Header: \", header\r\n\r\n# we're reading these backwards, so basically we stash one and then check it\r\n# once we get the one before it.\r\n\r\nnext_buf = null\r\ni = 0\r\nrewind.on \"buffer\", (chunk) ->\r\n  if next_buf\r\n    expected_ts = Number(chunk.ts) + chunk.duration\r\n    # is next_ts ~= b.ts?\r\n    if (Number(next_buf.ts) - 50 > expected_ts) || (expected_ts > Number(next_buf.ts) + 50)\r\n        console.log \"Gap? #{i}\\nGot: #{next_buf.ts}\\n  Expected: #{ new Date(expected_ts) }\\n  Offset: #{ Number(expected_ts - next_buf.ts) }\"\r\n\r\n  next_buf = chunk\r\n  i += 1\r\n\r\n\r\nrewind.loadBuffer stream, (err,stats) =>\r\n    console.log \"loadBuffer complete: \", stats\r\n"
  ]
}